<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Login Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: linear-gradient(135deg, #87CEEB, #98FB98); 
            min-height: 100vh; 
            margin: 0; 
        }
        .test-container { 
            max-width: 600px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.95); 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
        }
        .test-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
        }
        button { 
            background: linear-gradient(45deg, #4169E1, #1E90FF); 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: bold; 
            margin: 5px; 
        }
        button:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); 
        }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .info { color: #007bff; font-weight: bold; }
        input { 
            padding: 10px; 
            border: 1px solid #ccc; 
            border-radius: 5px; 
            margin: 5px; 
            font-size: 16px; 
        }
        pre { 
            background: #f8f9fa; 
            padding: 10px; 
            border-radius: 5px; 
            overflow-x: auto; 
            font-size: 12px; 
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”¥ Firebase ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h2>ğŸ® ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</h2>
            <input type="text" id="test-name" placeholder="í”Œë ˆì´ì–´ ì´ë¦„ (ì•„ë¹ )" value="ì•„ë¹ ">
            <input type="text" id="test-pin" placeholder="PIN (9329)" value="9329" maxlength="4">
            <button onclick="testLogin()">ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
            <div id="login-result"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”¥ Firebase ì—°ê²° ìƒíƒœ</h2>
            <button onclick="testFirebaseConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            <div id="firebase-status"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ† ê¸€ë¡œë²Œ ë¦¬ë”ë³´ë“œ</h2>
            <button onclick="loadLeaderboard()">ë¦¬ë”ë³´ë“œ ë¡œë“œ</button>
            <button onclick="addTestData()">í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€</button>
            <div id="leaderboard-result"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š ì‚¬ìš©ì í”„ë¡œí•„</h2>
            <button onclick="saveTestProfile()">í”„ë¡œí•„ ì €ì¥</button>
            <button onclick="loadTestProfile()">í”„ë¡œí•„ ë¡œë“œ</button>
            <div id="profile-result"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ¾ ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”</h2>
            <button onclick="simulateGameplay()">ê²Œì„í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜</button>
            <div id="sync-result"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“‹ ë¡œê·¸</h2>
            <button onclick="clearLogs()">ë¡œê·¸ í´ë¦¬ì–´</button>
            <div id="log-output"></div>
        </div>
    </div>

    <script type="module">
        // Firebase ëª¨ë“ˆ import
        import { initializeFirebase, handleLogin } from './js/auth/firebase-auth.js';
        import { testFirebaseConnection, saveUserProfile, loadUserProfile, 
                 getGlobalLeaderboard, updateGameScore, updateAnimalCollection } from './js/game/firebase-data.js';

        // ì „ì—­ í•¨ìˆ˜ë“¤
        window.currentUserProfile = null;
        window.currentUserId = null;

        // ë¡œê·¸ í•¨ìˆ˜
        function log(message, type = 'info') {
            const logEl = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            logEl.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // Firebase ì´ˆê¸°í™”
        async function initializeTest() {
            log('ğŸ”¥ Firebase í…ŒìŠ¤íŠ¸ í™˜ê²½ ì´ˆê¸°í™” ì¤‘...');
            
            try {
                const initialized = await initializeFirebase();
                if (initialized) {
                    log('âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ', 'success');
                    
                    // ìµëª… ë¡œê·¸ì¸ ëŒ€ê¸°
                    setTimeout(() => {
                        if (window.currentUserId) {
                            log(`ğŸ”‘ ìµëª… ë¡œê·¸ì¸ ì™„ë£Œ: ${window.currentUserId}`, 'success');
                        }
                    }, 2000);
                    
                } else {
                    log('âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                log(`âŒ Firebase ì´ˆê¸°í™” ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
        window.testLogin = async function() {
            const nameInput = document.getElementById('test-name');
            const pinInput = document.getElementById('test-pin');
            const resultEl = document.getElementById('login-result');
            
            const name = nameInput.value.trim();
            const pin = pinInput.value.trim();
            
            log(`ğŸ® ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì‹œì‘: ${name}/${pin}`);
            
            try {
                // ì„ì‹œ DOM ìš”ì†Œ ìƒì„± (handleLoginì´ DOMì„ ì°¾ê¸° ë•Œë¬¸)
                const tempName = document.createElement('input');
                tempName.id = 'player-name-input';
                tempName.value = name;
                document.body.appendChild(tempName);
                
                const tempPin = document.createElement('input');
                tempPin.id = 'player-pin-input';
                tempPin.value = pin;
                document.body.appendChild(tempPin);
                
                const tempFeedback = document.createElement('div');
                tempFeedback.id = 'login-feedback';
                document.body.appendChild(tempFeedback);
                
                // ë¡œê·¸ì¸ ì‹œë„
                await handleLogin();
                
                // ê²°ê³¼ í™•ì¸
                if (window.currentUserProfile) {
                    const profile = window.currentUserProfile;
                    resultEl.innerHTML = `
                        <div class="success">âœ… ë¡œê·¸ì¸ ì„±ê³µ!</div>
                        <pre>${JSON.stringify(profile, null, 2)}</pre>
                    `;
                    log(`âœ… ë¡œê·¸ì¸ ì„±ê³µ: ${profile.name}`, 'success');
                } else {
                    resultEl.innerHTML = `<div class="error">âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨</div>`;
                    log('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: í”„ë¡œí•„ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ', 'error');
                }
                
                // ì„ì‹œ ìš”ì†Œ ì •ë¦¬
                document.body.removeChild(tempName);
                document.body.removeChild(tempPin);
                document.body.removeChild(tempFeedback);
                
            } catch (error) {
                resultEl.innerHTML = `<div class="error">âŒ ë¡œê·¸ì¸ ì˜¤ë¥˜: ${error.message}</div>`;
                log(`âŒ ë¡œê·¸ì¸ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        };

        // Firebase ì—°ê²° í…ŒìŠ¤íŠ¸
        window.testFirebaseConnection = async function() {
            const statusEl = document.getElementById('firebase-status');
            
            log('ğŸ”¥ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            try {
                const isConnected = await testFirebaseConnection();
                if (isConnected) {
                    statusEl.innerHTML = '<div class="success">âœ… Firebase ì—°ê²° ì„±ê³µ!</div>';
                    log('âœ… Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ', 'success');
                } else {
                    statusEl.innerHTML = '<div class="error">âŒ Firebase ì—°ê²° ì‹¤íŒ¨</div>';
                    log('âŒ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                statusEl.innerHTML = `<div class="error">âŒ ì—°ê²° ì˜¤ë¥˜: ${error.message}</div>`;
                log(`âŒ Firebase ì—°ê²° ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        };

        // ë¦¬ë”ë³´ë“œ ë¡œë“œ
        window.loadLeaderboard = async function() {
            const resultEl = document.getElementById('leaderboard-result');
            
            log('ğŸ† ê¸€ë¡œë²Œ ë¦¬ë”ë³´ë“œ ë¡œë“œ ì‹œì‘...');
            
            try {
                const players = await getGlobalLeaderboard();
                if (players.length > 0) {
                    resultEl.innerHTML = `
                        <div class="success">âœ… ë¦¬ë”ë³´ë“œ ë¡œë“œ ì„±ê³µ! (${players.length}ëª…)</div>
                        <pre>${JSON.stringify(players, null, 2)}</pre>
                    `;
                    log(`âœ… ë¦¬ë”ë³´ë“œ ë¡œë“œ ì„±ê³µ: ${players.length}ëª…`, 'success');
                } else {
                    resultEl.innerHTML = '<div class="info">ğŸ“ ë¦¬ë”ë³´ë“œê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</div>';
                    log('ğŸ“ ë¦¬ë”ë³´ë“œê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.', 'info');
                }
            } catch (error) {
                resultEl.innerHTML = `<div class="error">âŒ ë¦¬ë”ë³´ë“œ ì˜¤ë¥˜: ${error.message}</div>`;
                log(`âŒ ë¦¬ë”ë³´ë“œ ë¡œë“œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        };

        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€
        window.addTestData = async function() {
            log('ğŸ“Š í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€ ì‹œì‘...');
            
            try {
                const testProfiles = [
                    { name: 'ì•„ë¹ ', totalScore: 150, collectedAnimals: ['í˜¸ë‘ì´', 'ì‚¬ì', 'ì½”ë¼ë¦¬'] },
                    { name: 'í…ŒìŠ¤í„°1', totalScore: 200, collectedAnimals: ['ê¸°ë¦°', 'ì–¼ë£©ë§'] },
                    { name: 'í…ŒìŠ¤í„°2', totalScore: 75, collectedAnimals: ['íŒë‹¤'] }
                ];
                
                for (const profile of testProfiles) {
                    window.currentUserProfile = profile;
                    window.currentUserId = `test_${profile.name}`;
                    await saveUserProfile(profile);
                }
                
                log('âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€ ì™„ë£Œ', 'success');
                await loadLeaderboard(); // ìë™ìœ¼ë¡œ ë¦¬ë”ë³´ë“œ ìƒˆë¡œê³ ì¹¨
                
            } catch (error) {
                log(`âŒ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        };

        // í”„ë¡œí•„ ì €ì¥ í…ŒìŠ¤íŠ¸
        window.saveTestProfile = async function() {
            const resultEl = document.getElementById('profile-result');
            
            if (!window.currentUserProfile) {
                resultEl.innerHTML = '<div class="error">âŒ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”!</div>';
                return;
            }
            
            log('ğŸ’¾ í”„ë¡œí•„ ì €ì¥ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            try {
                const success = await saveUserProfile(window.currentUserProfile);
                if (success) {
                    resultEl.innerHTML = '<div class="success">âœ… í”„ë¡œí•„ ì €ì¥ ì„±ê³µ!</div>';
                    log('âœ… í”„ë¡œí•„ ì €ì¥ ì„±ê³µ', 'success');
                } else {
                    resultEl.innerHTML = '<div class="error">âŒ í”„ë¡œí•„ ì €ì¥ ì‹¤íŒ¨</div>';
                    log('âŒ í”„ë¡œí•„ ì €ì¥ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                resultEl.innerHTML = `<div class="error">âŒ ì €ì¥ ì˜¤ë¥˜: ${error.message}</div>`;
                log(`âŒ í”„ë¡œí•„ ì €ì¥ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        };

        // í”„ë¡œí•„ ë¡œë“œ í…ŒìŠ¤íŠ¸
        window.loadTestProfile = async function() {
            const resultEl = document.getElementById('profile-result');
            
            if (!window.currentUserId) {
                resultEl.innerHTML = '<div class="error">âŒ ë¨¼ì € Firebase ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”!</div>';
                return;
            }
            
            log('ğŸ“– í”„ë¡œí•„ ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            try {
                const profile = await loadUserProfile(window.currentUserId);
                if (profile) {
                    resultEl.innerHTML = `
                        <div class="success">âœ… í”„ë¡œí•„ ë¡œë“œ ì„±ê³µ!</div>
                        <pre>${JSON.stringify(profile, null, 2)}</pre>
                    `;
                    log(`âœ… í”„ë¡œí•„ ë¡œë“œ ì„±ê³µ: ${profile.name}`, 'success');
                } else {
                    resultEl.innerHTML = '<div class="info">ğŸ“ í”„ë¡œí•„ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    log('ğŸ“ í”„ë¡œí•„ì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
                }
            } catch (error) {
                resultEl.innerHTML = `<div class="error">âŒ ë¡œë“œ ì˜¤ë¥˜: ${error.message}</div>`;
                log(`âŒ í”„ë¡œí•„ ë¡œë“œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        };

        // ê²Œì„í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜
        window.simulateGameplay = async function() {
            const resultEl = document.getElementById('sync-result');
            
            if (!window.currentUserProfile) {
                resultEl.innerHTML = '<div class="error">âŒ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”!</div>';
                return;
            }
            
            log('ğŸ® ê²Œì„í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘...');
            
            try {
                // ì ìˆ˜ ì—…ë°ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜
                const newScore = (window.currentUserProfile.totalScore || 0) + 50;
                await updateGameScore(newScore);
                log(`ğŸ“Š ì ìˆ˜ ì—…ë°ì´íŠ¸: ${newScore}ì `, 'success');
                
                // ë™ë¬¼ ìˆ˜ì§‘ ì‹œë®¬ë ˆì´ì…˜
                const newAnimal = `ëœë¤ë™ë¬¼_${Date.now()}`;
                await updateAnimalCollection(newAnimal);
                log(`ğŸ¾ ë™ë¬¼ ìˆ˜ì§‘: ${newAnimal}`, 'success');
                
                resultEl.innerHTML = `
                    <div class="success">âœ… ê²Œì„í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ!</div>
                    <div>ìƒˆ ì ìˆ˜: ${newScore}ì </div>
                    <div>ìˆ˜ì§‘í•œ ë™ë¬¼: ${newAnimal}</div>
                `;
                
                log('âœ… ê²Œì„í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ', 'success');
                
            } catch (error) {
                resultEl.innerHTML = `<div class="error">âŒ ì‹œë®¬ë ˆì´ì…˜ ì˜¤ë¥˜: ${error.message}</div>`;
                log(`âŒ ê²Œì„í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        };

        // ë¡œê·¸ í´ë¦¬ì–´
        window.clearLogs = function() {
            document.getElementById('log-output').innerHTML = '';
            log('ğŸ§¹ ë¡œê·¸ê°€ í´ë¦¬ì–´ë˜ì—ˆìŠµë‹ˆë‹¤.');
        };

        // Firebase ìµëª… ì¸ì¦ ì™„ë£Œ ì½œë°±
        window.onFirebaseReady = function(user) {
            if (user) {
                window.currentUserId = user.uid;
                log(`ğŸ”‘ Firebase Auth ì™„ë£Œ: ${user.uid}`, 'success');
            } else {
                log('âŒ Firebase Auth ì‹¤íŒ¨', 'error');
            }
        };

        // ì´ˆê¸°í™” ì‹¤í–‰
        initializeTest();
    </script>
</body>
</html>