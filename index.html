<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêæ ÎèôÎ¨º ÏàòÏßë ÌïôÏäµ Í≤åÏûÑ üêæ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; background: linear-gradient(135deg, #87CEEB 0%, #98FB98 50%, #FFB6C1 100%); min-height: 100vh; color: #333; }
        .game-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; background: rgba(255, 255, 255, 0.95); padding: 25px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .header h1 { color: #2C5530; font-size: 2.8rem; margin-bottom: 15px; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        .nav-buttons { display: flex; justify-content: center; gap: 10px; margin: 20px 0; flex-wrap: wrap; }
        .nav-btn { background: linear-gradient(45deg, #4169E1, #1E90FF); color: white; border: none; padding: 12px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; font-size: 0.9rem; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .nav-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        .nav-btn.active { background: linear-gradient(45deg, #32CD32, #228B22); }
        .user-info { margin: 15px 0; }
        .current-user { background: linear-gradient(45deg, #FF69B4, #FFB6C1); color: white; padding: 10px 20px; border-radius: 25px; font-weight: bold; display: inline-block; box-shadow: 0 4px 15px rgba(0,0,0,0.2); word-break: break-all; }
        .game-stats { display: flex; justify-content: center; gap: 20px; margin-top: 15px; flex-wrap: wrap; }
        .stat-item { background: linear-gradient(45deg, #FFD700, #FFA500); padding: 10px 20px; border-radius: 20px; font-weight: bold; color: #8B4513; box-shadow: 0 4px 15px rgba(0,0,0,0.2); min-width: 120px; text-align: center; }
        .page { display: none; }
        .page.active { display: block; }
        .game-content { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        .english-quiz-section { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); text-align: center; }
        .english-quiz-section h2 { color: #2C5530; margin-bottom: 20px; font-size: 1.8rem; }
        .english-question-container { display: flex; align-items: center; justify-content: center; gap: 15px; }
        .english-question { font-size: 2.5rem; color: #4169E1; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        .speak-btn { font-size: 2.5rem; cursor: pointer; transition: transform 0.2s; }
        .speak-btn:hover { transform: scale(1.2); }
        .english-options { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .english-option-btn { background: linear-gradient(45deg, #89CFF0, #4682B4); color: white; border: none; padding: 20px; border-radius: 15px; font-size: 1.5rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; }
        .english-option-btn:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .english-option-btn:disabled { cursor: not-allowed; opacity: 0.7; }
        .feedback { margin: 20px 0; padding: 20px; border-radius: 20px; font-weight: bold; text-align: center; font-size: 1.2rem; min-height: 60px; display: flex; align-items: center; justify-content: center; transition: all 0.5s ease; }
        .feedback.correct { background: linear-gradient(45deg, #90EE90, #32CD32); color: #006400; }
        .feedback.incorrect { background: linear-gradient(45deg, #FFB6C1, #FF69B4); color: #8B0000; }
        .collection-section { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .collection-section h2 { color: #2C5530; margin-bottom: 20px; text-align: center; font-size: 1.8rem; }
        .collection-hint { text-align: center; color: #666; margin-bottom: 20px; font-style: italic; }
        .animal-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 20px; max-height: 450px; overflow-y: auto; padding: 5px; }
        .animal-card { background: linear-gradient(45deg, #FFE4E1, #F0E68C); border-radius: 20px; padding: 15px; text-align: center; box-shadow: 0 6px 20px rgba(0,0,0,0.15); transition: all 0.3s ease; cursor: pointer; border: 3px solid transparent; }
        .animal-card:hover { transform: scale(1.08); box-shadow: 0 12px 35px rgba(0,0,0,0.25); }
        .animal-emoji { font-size: 3.5rem; display: block; margin-bottom: 10px; }
        .animal-name { font-weight: bold; color: #2C5530; margin-bottom: 5px; font-size: 1rem; word-break: keep-all; }
        .animal-level { font-weight: bold; font-size: 1.1rem; color: #8A2BE2; margin-bottom: 8px; }
        .special-name { color: #8B4513; font-style: italic; font-size: 0.9rem; margin-bottom: 8px; }
        .rarity-badge { background: linear-gradient(45deg, #FFD700, #FFA500); color: #8B4513; font-size: 0.8rem; font-weight: bold; padding: 4px 10px; border-radius: 12px; display: inline-block; }
        .modal { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
        .modal-content { margin: auto; padding: 30px; border: 1px solid #888; width: 90%; max-width: 500px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); text-align: center; position: relative; }
        .close-btn { color: #aaa; position: absolute; top: 15px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close-btn:hover, .close-btn:focus { color: black; }
        #math-modal .modal-content { background: linear-gradient(135deg, #e0f7fa, #ffffff, #fffde7); }
        #math-question { font-size: 2.5rem; color: #4169E1; margin: 25px 0; font-weight: bold; }
        #math-answer-input { font-size: 1.8rem; padding: 15px 20px; border: 3px solid #87CEEB; border-radius: 20px; width: 250px; margin: 15px; text-align: center; }
        #math-answer-input:disabled { background-color: #eee; }
        #math-submit-btn { background: linear-gradient(45deg, #32CD32, #228B22); color: white; border: none; padding: 18px 35px; font-size: 1.3rem; border-radius: 20px; cursor: pointer; margin: 15px; font-weight: bold; }
        #math-submit-btn:disabled { cursor: not-allowed; opacity: 0.7; }
        #math-feedback { min-height: 40px; margin-top: 15px; font-weight: bold; font-size: 1.1rem; }
        .instructions { background: rgba(255, 255, 255, 0.95); padding: 40px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); max-width: 900px; margin: 0 auto; }
        .instructions h2 { color: #2C5530; font-size: 2.2rem; margin-bottom: 25px; text-align: center; }
        .instructions h3 { color: #4169E1; font-size: 1.4rem; margin: 25px 0 15px 0; }
        .instructions p, .instructions li { font-size: 1.1rem; line-height: 1.7; color: #333; margin-bottom: 12px; }
        .instructions ul { margin-left: 25px; margin-bottom: 18px; }
        .encyclopedia-container { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .encyclopedia-container h2 { color: #2C5530; text-align: center; font-size: 2rem; margin-bottom: 20px; }
        .encyclopedia-progress { text-align: center; font-size: 1.2rem; font-weight: bold; color: #4169E1; margin-bottom: 20px; }
        .progress-bar-container { width: 80%; max-width: 500px; height: 25px; background-color: #e0e0e0; border-radius: 15px; margin: 10px auto; overflow: hidden; }
        .progress-bar-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #98FB98, #32CD32); border-radius: 15px; transition: width 0.5s ease-in-out; }
        .encyclopedia-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; max-height: 60vh; overflow-y: auto; padding: 10px; }
        .encyclopedia-card { background: #fff; border-radius: 15px; padding: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: all 0.3s ease; }
        .encyclopedia-card.uncollected { filter: grayscale(100%); opacity: 0.6; }
        .encyclopedia-card .animal-emoji { font-size: 3rem; }
        .encyclopedia-card .animal-name { font-size: 1rem; }
        .encyclopedia-card .animal-count { font-size: 0.9rem; color: #666; }
        .farm-page-container { display: grid; grid-template-columns: 300px 1fr; gap: 20px; }
        .farm-controls { background: rgba(255, 255, 255, 0.95); padding: 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .farm-controls h3 { color: #2C5530; text-align: center; margin-bottom: 15px; }
        .shop-grid, .inventory-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-height: 250px; overflow-y: auto; padding: 5px; }
        .shop-item, .inventory-item { background: #f0f8ff; border-radius: 15px; padding: 10px; text-align: center; cursor: pointer; transition: all 0.2s ease; border: 2px solid #87CEEB; }
        .shop-item:hover, .inventory-item:hover { transform: scale(1.05); background: #e0f0ff; }
        .inventory-item.selected { border-color: #FF69B4; background: #ffe6f0; }
        .item-emoji { font-size: 2.5rem; }
        .item-name { font-weight: bold; font-size: 0.9rem; }
        .item-price, .item-count { font-size: 0.8rem; color: #555; }
        .farm-area { background: linear-gradient(to bottom, #a8e063, #56ab2f); padding: 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .farm-grid { display: grid; grid-template-columns: repeat(8, 1fr); grid-template-rows: repeat(6, 1fr); gap: 5px; aspect-ratio: 8 / 6; }
        .farm-cell { background: rgba(255, 255, 255, 0.2); border-radius: 10px; cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; position: relative; }
        .farm-cell:hover { background: rgba(255, 255, 255, 0.4); }
        .farm-cell .placed-animal { position: absolute; bottom: 5px; opacity: 0.9; animation: bounce 2s infinite ease-in-out; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .synthesis-container { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .synthesis-container h2 { color: #2C5530; text-align: center; font-size: 2rem; margin-bottom: 20px; }
        .synthesis-grid { display: grid; grid-template-columns: 1fr; gap: 20px; max-height: 70vh; overflow-y: auto; padding: 10px; }
        .synthesis-card { background: linear-gradient(45deg, #f0e6ff, #e6f3ff); border-radius: 20px; padding: 20px; display: flex; align-items: center; justify-content: space-around; box-shadow: 0 6px 20px rgba(0,0,0,0.1); }
        .synthesis-ingredient, .synthesis-result { text-align: center; }
        .synthesis-ingredient .animal-emoji { font-size: 3rem; }
        .synthesis-ingredient.not-owned { filter: grayscale(100%); opacity: 0.5; }
        .synthesis-symbol { font-size: 2.5rem; font-weight: bold; color: #4169E1; }
        .synthesis-btn { background: linear-gradient(45deg, #9370DB, #8A2BE2); color: white; border: none; padding: 12px 24px; border-radius: 15px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; }
        .synthesis-btn:disabled { background: #ccc; cursor: not-allowed; }
        .new-animal-alert { z-index: 1000; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(45deg, #FFD700, #FFA500); padding: 35px; border-radius: 25px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.4); animation: popIn 0.6s ease; }
        .new-animal-alert .new-animal-emoji { font-size: 6rem; display: block; margin-bottom: 20px; }
        .new-animal-alert h3 { color: #8B4513; margin-bottom: 15px; font-size: 1.5rem; }
        .new-animal-alert p { color: #8B4513; font-weight: bold; margin-bottom: 10px; }
        @keyframes popIn { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
        
        /* [NEW] Î°úÍ∑∏Ïù∏ Î™®Îã¨ Ïä§ÌÉÄÏùº */
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        #login-modal { background: white; padding: 40px; border-radius: 25px; width: 90%; max-width: 400px; text-align: center; }
        #login-modal h2 { margin-bottom: 20px; color: #2C5530; }
        .login-input { width: 100%; padding: 15px; margin-bottom: 15px; font-size: 1.2rem; border-radius: 15px; border: 2px solid #ccc; }
        .login-btn { width: 100%; padding: 15px; font-size: 1.2rem; border-radius: 15px; border: none; color: white; cursor: pointer; margin-top: 10px; font-weight: bold; }
        #login-btn { background: linear-gradient(45deg, #4169E1, #1E90FF); }
        #signup-btn { background: linear-gradient(45deg, #32CD32, #228B22); }
        #login-feedback { margin-top: 15px; color: red; font-weight: bold; min-height: 20px; }

        @media (max-width: 900px) {
            .game-content, .farm-page-container { grid-template-columns: 1fr; }
            .farm-controls { margin-bottom: 20px; }
        }
        @media (max-width: 768px) {
            .game-container { padding: 15px; }
            .header h1 { font-size: 2.2rem; }
            .game-stats { flex-direction: column; align-items: center; gap: 10px; }
            .nav-buttons { flex-direction: column; align-items: center; gap: 10px; }
            .english-question { font-size: 2rem; }
            .english-option-btn { font-size: 1.2rem; padding: 15px; }
            .animal-grid { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; }
            .user-list { grid-template-columns: 1fr; }
            .encyclopedia-grid { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
            .synthesis-card { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>
    <!-- [NEW] Î°úÍ∑∏Ïù∏ Î™®Îã¨ -->
    <div id="login-overlay">
        <div id="login-modal">
            <h2>üêæ ÎèôÎ¨º ÏàòÏßë ÌïôÏäµ Í≤åÏûÑ üêæ</h2>
            <input type="text" id="player-name-input" class="login-input" placeholder="ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Î¶Ñ">
            <input type="password" id="player-pin-input" class="login-input" placeholder="4ÏûêÎ¶¨ Ïà´Ïûê PIN" maxlength="4" pattern="\d*">
            <button id="login-btn" class="login-btn">Î°úÍ∑∏Ïù∏</button>
            <button id="signup-btn" class="login-btn">ÏÉà ÌîåÎ†àÏù¥Ïñ¥ ÎßåÎì§Í∏∞</button>
            <p id="login-feedback"></p>
        </div>
    </div>

    <div class="game-container" style="display: none;"> <!-- Í≤åÏûÑ Ïª®ÌÖêÏ∏†Îäî Î°úÍ∑∏Ïù∏ ÌõÑ ÌëúÏãú -->
        <!-- Ìó§Îçî -->
        <div class="header">
            <h1>üêæ ÎèôÎ¨º ÏàòÏßë ÌïôÏäµ Í≤åÏûÑ üêæ</h1>
            
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showPage('game', this)">ÎèôÎ¨º Ïû°Í∏∞ üá¨üáß</button>
                <button class="nav-btn" onclick="showPage('synthesis', this)">ÎèôÎ¨º Ìï©ÏÑ± üß¨</button>
                <button class="nav-btn" onclick="showPage('farm', this)">ÎÜçÏû• Íæ∏ÎØ∏Í∏∞ üè°</button>
                <button class="nav-btn" onclick="showPage('encyclopedia', this)">ÎèôÎ¨º ÎèÑÍ∞ê üìö</button>
                <button class="nav-btn" onclick="showPage('instructions', this)">ÏÇ¨Ïö©ÏÑ§Î™ÖÏÑú üìñ</button>
                <button class="nav-btn" onclick="logout()">Î°úÍ∑∏ÏïÑÏõÉ üö™</button>
            </div>

            <div class="user-info" id="user-info">
                <div class="current-user">ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥: <span id="current-user-name"></span></div>
            </div>

            <div class="game-stats" id="game-stats">
                <div class="stat-item">Î†àÎ≤® <span id="level">1</span></div>
                <div class="stat-item">Ï†êÏàò: <span id="score">0</span></div>
                <div class="stat-item">ÎèôÎ¨º Ï¢ÖÎ•ò: <span id="species-count">0</span>Ï¢Ö</div>
                <div class="stat-item">Ï¥ù ÎèôÎ¨º: <span id="total-animals">0</span>ÎßàÎ¶¨</div>
            </div>
        </div>

        <!-- Í≤åÏûÑ ÌéòÏù¥ÏßÄ -->
        <div id="game-page" class="page active">
            <div class="game-content">
                <div class="english-quiz-section">
                    <h2>üá¨üáß ÏòÅÏñ¥ ÌÄ¥Ï¶à: ÎèôÎ¨º Ïû°Í∏∞!</h2>
                    <div class="english-question-container">
                        <div class="english-question" id="english-question">ÏßàÎ¨∏</div>
                        <span id="speak-button" class="speak-btn" title="Îã®Ïñ¥ Î∞úÏùå Îì£Í∏∞">üîä</span>
                    </div>
                    <div class="english-options" id="english-options"></div>
                    <div class="feedback" id="feedback"></div>
                </div>

                <div class="collection-section">
                    <h2>üêæ ÎÇ¥ ÎèôÎ¨º Ïª¨Î†âÏÖò</h2>
                    <p class="collection-hint">üí° ÎèôÎ¨ºÏùÑ ÌÅ¥Î¶≠Ìï¥ÏÑú ÏàòÌïô Î¨∏Ï†úÎ°ú Î†àÎ≤®ÏóÖ ÏãúÏºúÏöî!</p>
                    <div class="animal-grid" id="animal-collection"></div>
                </div>
            </div>
        </div>
        
        <!-- ÎèôÎ¨º Ìï©ÏÑ± ÌéòÏù¥ÏßÄ -->
        <div id="synthesis-page" class="page">
            <div class="synthesis-container">
                <h2>üß¨ ÎèôÎ¨º Ìï©ÏÑ± Ïó∞Íµ¨ÏÜå</h2>
                <div class="synthesis-grid" id="synthesis-grid"></div>
            </div>
        </div>
        
        <!-- ÎÜçÏû• Íæ∏ÎØ∏Í∏∞ ÌéòÏù¥ÏßÄ -->
        <div id="farm-page" class="page">
            <div class="farm-page-container">
                <div class="farm-controls">
                    <h3>üå≥ ÏÉÅÏ†ê üí∞</h3>
                    <div class="shop-grid" id="shop-grid"></div>
                    <hr style="margin: 20px 0;">
                    <h3>üéí Î≥¥Í¥ÄÌï®</h3>
                    <div class="inventory-grid" id="inventory-grid"></div>
                </div>
                <div class="farm-area">
                    <div class="farm-grid" id="farm-grid"></div>
                </div>
            </div>
        </div>
        
        <!-- ÎèôÎ¨º ÎèÑÍ∞ê ÌéòÏù¥ÏßÄ -->
        <div id="encyclopedia-page" class="page">
            <div class="encyclopedia-container">
                <h2>üìö ÎèôÎ¨º ÎèÑÍ∞ê</h2>
                <div class="encyclopedia-progress">
                    ÏàòÏßëÎ•†: <span id="collection-progress">0 / 105</span> Ï¢Ö
                    <div class="progress-bar-container">
                        <div id="progress-bar" class="progress-bar-fill"></div>
                    </div>
                </div>
                <div class="encyclopedia-grid" id="encyclopedia-grid"></div>
            </div>
        </div>

        <!-- ÏÇ¨Ïö©ÏÑ§Î™ÖÏÑú ÌéòÏù¥ÏßÄ -->
        <div id="instructions-page" class="page">
            <div class="instructions">
                <h2>üìñ Í≤åÏûÑ ÏÇ¨Ïö©ÏÑ§Î™ÖÏÑú</h2>
                <h3>üîë Î°úÍ∑∏Ïù∏Í≥º Ï†ÄÏû•</h3>
                <p>Ïù¥ Í≤åÏûÑÏùÄ Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÌÅ¥ÎùºÏö∞ÎìúÏóê ÏûêÎèôÏúºÎ°ú Ï†ÄÏû•Îê©ÎãàÎã§. Ï≤òÏùå Ï†ëÏÜç Ïãú ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Î¶ÑÍ≥º 4ÏûêÎ¶¨ Ïà´Ïûê PINÏúºÎ°ú Í≥ÑÏ†ïÏùÑ ÎßåÎìúÏÑ∏Ïöî. Îã§ÏùåÎ∂ÄÌÑ∞Îäî Í∞ôÏùÄ Ï†ïÎ≥¥Î°ú Î°úÍ∑∏Ïù∏ÌïòÎ©¥ Ïñ¥ÎîîÏÑúÎì† Ïù¥Ïñ¥ÏÑú Ìï† Ïàò ÏûàÏäµÎãàÎã§.</p>
                <h3>üß¨ ÎèôÎ¨º Ìï©ÏÑ± ÏãúÏä§ÌÖú</h3>
                <p>ÌäπÏ†ï ÎèôÎ¨º Îëê ÎßàÎ¶¨Î•º Ï°∞Ìï©ÌïòÏó¨ ÏÉàÎ°úÏö¥ Ï†ÑÏÑ§ ÎèôÎ¨ºÏùÑ ÎßåÎì§ Ïàò ÏûàÏäµÎãàÎã§. Ìï©ÏÑ±Ïóê ÏÇ¨Ïö©Îêú ÎèôÎ¨ºÏùÄ ÏÇ¨ÎùºÏßÄÎãà Ïã†Ï§ëÌïòÍ≤å Í≤∞Ï†ïÌïòÏÑ∏Ïöî!</p>
                <h3>üá¨üáß ÎèôÎ¨º Ïû°Í∏∞ (ÏòÅÏñ¥ ÌÄ¥Ï¶à)</h3>
                <p>Ï†ïÎãµÏùÑ ÎßûÌûàÎ©¥ Ï†êÏàòÎ•º ÏñªÍ≥† ÏÉàÎ°úÏö¥ ÎèôÎ¨ºÏùÑ Ïû°ÏùÑ Ïàò ÏûàÏäµÎãàÎã§!</p>
                <h3>üßÆ ÎèôÎ¨º Î†àÎ≤®ÏóÖ (ÏàòÌïô Î¨∏Ï†ú)</h3>
                <p>ÏàòÏßëÌïú ÎèôÎ¨ºÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ Î†àÎ≤®ÏóÖÏùÑ ÏúÑÌïú ÏàòÌïô Î¨∏Ï†úÍ∞Ä ÎÇòÌÉÄÎÇ©ÎãàÎã§. Î¨∏Ï†úÎ•º ÌíÄÎ©¥ Ï†êÏàòÎ•º ÏñªÍ≥† ÎèôÎ¨ºÏùò Î†àÎ≤®Ïù¥ Ïò§Î¶ÖÎãàÎã§.</p>
            </div>
        </div>
    </div>
    
    <!-- ÏàòÌïô Î¨∏Ï†ú Î™®Îã¨ HTML -->
    <div id="math-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeMathModal()">&times;</span>
            <h3>üßÆ ÎèôÎ¨º Î†àÎ≤®ÏóÖ!</h3>
            <div id="math-question">5 + 3 = ?</div>
            <input type="number" id="math-answer-input" placeholder="Ï†ïÎãµÏùÄ?">
            <br>
            <button id="math-submit-btn">ÌôïÏù∏</button>
            <div id="math-feedback"></div>
        </div>
    </div>

    <!-- Firebase SDK and Game Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, getDocs, writeBatch } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        let auth, db;
        
        try {
            const firebaseConfig = {
              apiKey: "AIzaSyC2JV9KsIZ-M1crdnnxLfxyaRtGS1Brtcc",
              authDomain: "animal-math-game-6eec2.firebaseapp.com",
              projectId: "animal-math-game-6eec2",
              storageBucket: "animal-math-game-6eec2.firebasestorage.app",
              messagingSenderId: "104144283045",
              appId: "1:104144283045:web:f0a387d83292a0d508744c",
              measurementId: "G-M63W08193X"
            };
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);

            window.firebase = {
                auth, db, doc, getDoc, setDoc, collection, getDocs, writeBatch
            };

            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    console.log("Firebase Auth User:", user.uid);
                    window.onFirebaseReady(user);
                } else {
                     try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (error) {
                        console.error("Anonymous sign-in failed:", error);
                        window.onFirebaseReady(null);
                    }
                }
            });
        } catch (error) {
            console.error("Firebase initialization failed:", error);
            window.onFirebaseReady(null);
        }
    </script>
    
    <script>
        // ==================== Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞ ====================
        
        let gameState = {
            score: 0,
            level: 1,
            currentQuestion: {},
            animals: {},
            totalAnimals: 0,
            speciesCount: 0,
            farm: {
                layout: Array(48).fill(null),
                items: {}
            }
        };

        let currentUserId = null;
        let currentUserProfile = {};
        let selectedItemToPlace = null;
        let currentEnglishQuiz = {};

        const animalTypes = [
            {emoji: 'üê∂', name: 'Í∞ïÏïÑÏßÄ', specialName: 'Î©çÎ©çÏôïÏûê', rarity: 1}, {emoji: 'üê±', name: 'Í≥†ÏñëÏù¥', specialName: 'ÏïºÏòπÍ≥µÏ£º', rarity: 1}, {emoji: 'üê∞', name: 'ÌÜ†ÎÅº', specialName: 'Íπ°Ï¥ùÎåÄÏû•', rarity: 1}, {emoji: 'üê∑', name: 'ÎèºÏßÄ', specialName: 'ÍøÄÍøÄÎåÄÎßàÏôï', rarity: 1}, {emoji: 'üêÆ', name: 'ÏÜå', specialName: 'ÏùåÎ©îÏöîÏ†ï', rarity: 1}, {emoji: 'üêî', name: 'Îã≠', specialName: 'Íº¨Íº¨ÎåÅ ÏÇ¨Î†πÍ¥Ä', rarity: 1}, {emoji: 'üê∏', name: 'Í∞úÍµ¨Î¶¨', specialName: 'Í∞úÍ≥®Î∞ïÏÇ¨', rarity: 1}, {emoji: 'ü¶Ü', name: 'Ïò§Î¶¨', specialName: 'ÍΩ•ÍΩ•ÏÑ†Ïû•', rarity: 1}, {emoji: 'üê≠', name: 'Ï•ê', specialName: 'ÏπòÏ¶à ÌÉêÌóòÍ∞Ä', rarity: 1}, {emoji: 'üêπ', name: 'ÌñÑÏä§ÌÑ∞', specialName: 'Ìï¥Î∞îÎùºÍ∏∞Ïî® Î∂ÄÏûê', rarity: 1}, {emoji: 'üêë', name: 'Ïñë', specialName: 'Î≠âÍ≤åÍµ¨Î¶Ñ', rarity: 1}, {emoji: 'ü¶ã', name: 'ÎÇòÎπÑ', specialName: 'Î¨¥ÏßÄÍ∞úÎÇ†Í∞ú', rarity: 1}, {emoji: 'üêù', name: 'Î≤å', specialName: 'ÍøÄÎ≤åÍ∏∞ÏÇ¨', rarity: 1}, {emoji: 'üêû', name: 'Î¨¥ÎãπÎ≤åÎ†à', specialName: 'ÌñâÏö¥Ïùò ÏöîÏ†ï', rarity: 1}, {emoji: 'üêå', name: 'Îã¨ÌåΩÏù¥', specialName: 'ÎäêÎ¶ºÏùò ÎØ∏Ìïô', rarity: 1}, {emoji: 'üêü', name: 'Î¨ºÍ≥†Í∏∞', specialName: 'Î∞îÎã§Ïùò Ïó¨ÌñâÏûê', rarity: 1}, {emoji: 'ü¶Ä', name: 'Í≤å', specialName: 'ÏòÜÍ±∏ÏùåÏùò Îã¨Ïù∏', rarity: 1}, {emoji: 'üêøÔ∏è', name: 'Îã§ÎûåÏ•ê', specialName: 'ÎèÑÌÜ†Î¶¨ ÏàòÏßëÍ∞Ä', rarity: 1}, {emoji: 'üê¶', name: 'ÏÉà', specialName: 'ÌïòÎäòÏùò Ìé∏ÏßÄ', rarity: 1}, {emoji: 'üêõ', name: 'Ïï†Î≤åÎ†à', specialName: 'Î≥ÄÏã†Ïùò Í∑ÄÏû¨', rarity: 1}, {emoji: 'üêú', name: 'Í∞úÎØ∏', specialName: 'ÏûëÏùÄ Í±¥Ï∂ïÍ∞Ä', rarity: 1}, {emoji: 'üê¢', name: 'Í±∞Î∂ÅÏù¥', specialName: 'ÏãúÍ∞Ñ Ïó¨ÌñâÏûê', rarity: 1}, {emoji: 'üêê', name: 'ÏóºÏÜå', specialName: 'Ï¢ÖÏù¥ ÎØ∏ÏãùÍ∞Ä', rarity: 1}, {emoji: 'üê¥', name: 'Îßê', specialName: 'Ï¥àÏõêÏùò Î∞îÎûå', rarity: 1}, {emoji: 'üê†', name: 'Ïó¥ÎåÄÏñ¥', specialName: 'ÏÇ∞Ìò∏Ï¥àÏùò Î≥¥ÏÑù', rarity: 1},
            {emoji: 'ü¶ä', name: 'Ïó¨Ïö∞', specialName: 'Ïà≤ÏÜçÏùò Ïã†ÏÇ¨', rarity: 2}, {emoji: 'üêª', name: 'Í≥∞', specialName: 'ÍøÄÎã®ÏßÄ ÌååÏàòÍæº', rarity: 2}, {emoji: 'ü¶ù', name: 'ÎÑàÍµ¨Î¶¨', specialName: 'ÏÜúÏÇ¨ÌÉï ÏÇ¨ÎÉ•Íæº', rarity: 2}, {emoji: 'ü¶å', name: 'ÏÇ¨Ïä¥', specialName: 'Ïà≤Ïùò ÏôïÏûê', rarity: 2}, {emoji: 'ü¶â', name: 'Ïò¨ÎπºÎØ∏', specialName: 'ÏßÄÌòúÎ°úÏö¥ Ïûê', rarity: 2}, {emoji: 'üê∫', name: 'ÎäëÎåÄ', specialName: 'Îã¨ÎπõÏÇ¨ÎÉ•Íæº', rarity: 2}, {emoji: 'ü¶á', name: 'Î∞ïÏ•ê', specialName: 'Î∞§Ïùò ÎπÑÌñâÏÇ¨', rarity: 2}, {emoji: 'üêç', name: 'Î±Ä', specialName: 'ÎπÑÎ∞ÄÏùò ÏàòÌò∏Ïûê', rarity: 2}, {emoji: 'ü¶Ö', name: 'ÎèÖÏàòÎ¶¨', specialName: 'ÌïòÎäòÏùò Ï†úÏôï', rarity: 2}, {emoji: 'üêß', name: 'Ìé≠Í∑Ñ', specialName: 'ÏñºÏùå Ïã†ÏÇ¨', rarity: 2}, {emoji: 'üê®', name: 'ÏΩîÏïåÎùº', specialName: 'Ïú†ÏπºÎ¶ΩÌà¨Ïä§ ÏöîÏ†ï', rarity: 2}, {emoji: 'üêí', name: 'ÏõêÏà≠Ïù¥', specialName: 'Ïû•ÎÇúÍæ∏Îü¨Í∏∞ ÎåÄÏû•', rarity: 2}, {emoji: 'üêó', name: 'Î©ßÎèºÏßÄ', specialName: 'ÎèåÍ≤©ÎåÄÏû•', rarity: 2}, {emoji: 'ü¶¶', name: 'ÏàòÎã¨', specialName: 'Ï°∞ÏïΩÎèå ÏïÑÌã∞Ïä§Ìä∏', rarity: 2}, {emoji: 'ü¶¢', name: 'Î∞±Ï°∞', specialName: 'Ìò∏ÏàòÏùò Ïó¨Ïôï', rarity: 2}, {emoji: 'ü¶î', name: 'Í≥†Ïä¥ÎèÑÏπò', specialName: 'Î∞§ÏÜ°Ïù¥ Í∏∞ÏÇ¨', rarity: 2}, {emoji: 'ü¶é', name: 'ÎèÑÎßàÎ±Ä', specialName: 'ÌñáÏÇ¥ ÏÇ¨ÎÉ•Íæº', rarity: 2}, {emoji: 'üêô', name: 'Î¨∏Ïñ¥', specialName: 'Ï¥âÏàòÎßàÎ≤ïÏÇ¨', rarity: 2}, {emoji: 'ü¶ê', name: 'ÏÉàÏö∞', specialName: 'Î∞îÎã§Ïùò ÎåÑÏÑú', rarity: 2}, {emoji: 'ü¶ë', name: 'Ïò§ÏßïÏñ¥', specialName: 'Î®πÎ¨º ÏòàÏà†Í∞Ä', rarity: 2}, {emoji: 'ü¶ò', name: 'Ï∫•Í±∞Î£®', specialName: 'Ïä§ÌÖùÏùò Ï±îÌîºÏñ∏', rarity: 2}, {emoji: 'üïäÔ∏è', name: 'ÎπÑÎëòÍ∏∞', specialName: 'ÌèâÌôîÏùò ÏÇ¨ÎèÑ', rarity: 2}, {emoji: 'ü¶ú', name: 'ÏïµÎ¨¥ÏÉà', specialName: 'ÎßêÌïòÎäî Î≥¥ÏÑù', rarity: 2}, {emoji: 'üê´', name: 'ÎÇôÌÉÄ', specialName: 'ÏÇ¨ÎßâÏùò ÏÉÅÏù∏', rarity: 2}, {emoji: 'ü¶ô', name: 'ÎùºÎßà', specialName: 'ÏïàÎç∞Ïä§Ïùò Ïã†ÏÇ¨', rarity: 2},
            {emoji: 'üêò', name: 'ÏΩîÎÅºÎ¶¨', specialName: 'Í∏∞ÏñµÏùò ÌòÑÏûê', rarity: 3}, {emoji: 'ü¶í', name: 'Í∏∞Î¶∞', specialName: 'Íµ¨Î¶Ñ ÏÇ∞Ï±ÖÍ∞Ä', rarity: 3}, {emoji: 'ü¶ì', name: 'ÏñºÎ£©Îßê', specialName: 'Ï¥àÏõêÏùò ÏàòÏàòÍªòÎÅº', rarity: 3}, {emoji: 'üêº', name: 'ÌåêÎã§', specialName: 'ÎåÄÎÇòÎ¨¥ ÎØ∏ÏãùÍ∞Ä', rarity: 3}, {emoji: 'ü¶õ', name: 'ÌïòÎßà', specialName: 'Í∞ïÏùò Íµ∞Ï£º', rarity: 3}, {emoji: 'ü¶è', name: 'ÏΩîÎøîÏÜå', specialName: 'Í∞ïÏ≤†Ïùò ÎèåÍ≤©Ïàò', rarity: 3}, {emoji: 'üêä', name: 'ÏïÖÏñ¥', specialName: 'Îä™Ïùò Ìè¨ÏãùÏûê', rarity: 3}, {emoji: 'üêÖ', name: 'Ìò∏ÎûëÏù¥', specialName: 'Î∞ÄÎ¶ºÏùò Íµ∞Ï£º', rarity: 3}, {emoji: 'üêÜ', name: 'ÌëúÎ≤î', specialName: 'Í∑∏Î¶ºÏûê ÏïîÏÇ¥Ïûê', rarity: 3}, {emoji: 'ü¶ç', name: 'Í≥†Î¶¥Îùº', specialName: 'Ïà≤Ïùò ÏàòÌò∏Ïã†', rarity: 3}, {emoji: 'üê¨', name: 'ÎèåÍ≥†Îûò', specialName: 'ÌååÎèÑÏùò ÏπúÍµ¨', rarity: 3}, {emoji: 'üêã', name: 'Í≥†Îûò', specialName: 'Ïã¨Ìï¥Ïùò ÎÖ∏Îûò', rarity: 3}, {emoji: 'ü¶à', name: 'ÏÉÅÏñ¥', specialName: 'Î∞îÎã§Ïùò Ï∂îÍ≤©Ïûê', rarity: 3}, {emoji: 'ü¶ö', name: 'Í≥µÏûë', specialName: 'Î≥ÑÎπõ ÍπÉÌÑ∏', rarity: 3}, {emoji: 'ü¶Ç', name: 'Ï†ÑÍ∞à', specialName: 'ÏÇ¨ÎßâÏùò ÎèÖÏπ®', rarity: 3}, {emoji: 'ü¶•', name: 'ÎÇòÎ¨¥ÎäòÎ≥¥', specialName: 'ÎäêÍ∏ãÌïú Ï≤†ÌïôÏûê', rarity: 3}, {emoji: 'üêÉ', name: 'Î¨ºÏÜå', specialName: 'ÏßÑÌùôÏùò Ïôï', rarity: 3}, {emoji: 'ü¶û', name: 'Î∞îÎã∑Í∞ÄÏû¨', specialName: 'Ïã¨Ìï¥Ïùò Í∏∞ÏÇ¨', rarity: 3}, {emoji: 'üê°', name: 'Î≥µÏñ¥', specialName: 'Í∞ÄÏãú Î∞©Ìå®', rarity: 3}, {emoji: 'ü¶°', name: 'Ïò§ÏÜåÎ¶¨', specialName: 'ÎïÖÍµ¥Ïùò Ï†úÏôï', rarity: 3},
            {emoji: 'ü¶Å', name: 'ÏÇ¨Ïûê', specialName: 'Ìô©Í∏àÍ∞àÍ∏∞Ïôï', rarity: 4}, {emoji: 'üêª‚Äç‚ùÑÔ∏è', name: 'Î∂ÅÍ∑πÍ≥∞', specialName: 'ÏÑ§ÏõêÏùò ÏßÄÎ∞∞Ïûê', rarity: 4}, {emoji: 'ü¶£', name: 'Îß§Î®∏Îìú', specialName: 'ÎπôÌïòÍ∏∞Ïùò Í±∞Ïù∏', rarity: 4}, {emoji: 'ü¶ñ', name: 'Ìã∞ÎùºÎÖ∏ÏÇ¨Ïö∞Î£®Ïä§', specialName: 'Ìè≠Íµ∞ ÎèÑÎßàÎ±Ä', rarity: 4}, {emoji: 'üêâ', name: 'Ïö©', specialName: 'Ï†ÑÏÑ§Ïùò ÎìúÎûòÍ≥§', rarity: 4}, {emoji: 'üê≥', name: 'ÎåÄÏôïÍ≥†Îûò', specialName: 'ÎåÄÏñëÏùò Ïã¨Ïû•', rarity: 4}, {emoji: 'ü¶ë', name: 'ÎåÄÏôïÏò§ÏßïÏñ¥', specialName: 'ÌÅ¨ÎùºÏºÑÏùò ÌõÑÏòà', rarity: 4}, {emoji: 'ü¶Ö', name: 'ÌïòÌîº', specialName: 'Ï∞ΩÍ≥µÏùò ÏßÄÎ∞∞Ïûê', rarity: 4}, {emoji: 'ü¶ß', name: 'Ïò§ÎûëÏö∞ÌÉÑ', specialName: 'Ïà≤Ïùò ÌòÑÏûê', rarity: 4}, {emoji: 'üêÖ', name: 'Î∞±Ìò∏', specialName: 'Îã¨Ïùò Ï†ïÍ∏∞', rarity: 4}, {emoji: 'üêà‚Äç‚¨õ', name: 'ÌùëÌëúÎ≤î', specialName: 'Î∞§Ïùò Í∑∏Î¶ºÏûê', rarity: 4}, {emoji: 'ü¶ï', name: 'Î∏åÎùºÌÇ§Ïò§ÏÇ¨Ïö∞Î£®Ïä§', specialName: 'ÏõÄÏßÅÏù¥Îäî Ïà≤', rarity: 4}, {emoji: 'ü¶ó', name: 'ÏÇ¨ÎßàÍ∑Ä', specialName: 'ÎãπÎûëÍ∂åÏùò Í≥†Ïàò', rarity: 4}, {emoji: 'üï∑Ô∏è', name: 'Í±∞ÎØ∏', specialName: 'Í±∞ÎØ∏Ï§ÑÏùò ÏÑ§Í≥ÑÏûê', rarity: 4}, {emoji: 'ü¶ä', name: 'Î∂ÅÍ∑πÏó¨Ïö∞', specialName: 'ÏÑ§ÏõêÏùò Ïú†Î†π', rarity: 4},
            {emoji: 'ü¶Ñ', name: 'Ïú†ÎãàÏΩò', specialName: 'ÏàúÏàòÏùò Îøî', rarity: 5}, {emoji: 'üê≤', name: 'ÎèôÏñëÏö©', specialName: 'Ïó¨ÏùòÏ£ºÏùò Ï£ºÏù∏', rarity: 5}, {emoji: 'üî•', name: 'Î∂àÏÇ¨Ï°∞', specialName: 'Î∂àÎ©∏Ïùò ÌôîÏã†', rarity: 5}, {emoji: 'ü¶Å', name: 'Í∑∏Î¶¨ÌïÄ', specialName: 'ÏÇ¨ÏûêÏôÄ ÎèÖÏàòÎ¶¨Ïùò Ïôï', rarity: 5}, {emoji: 'üêé', name: 'ÌéòÍ∞ÄÏàòÏä§', specialName: 'ÎÇ†Í∞ú Îã¨Î¶∞ Ï≤úÎßà', rarity: 5}, {emoji: 'üê∫', name: 'ÌéúÎ¶¨Î•¥', specialName: 'Ïã†Ìôî ÏÜç ÎäëÎåÄ', rarity: 5}, {emoji: 'üêç', name: 'ÌûàÎìúÎùº', specialName: 'Î∂àÎ©∏Ïùò Î®∏Î¶¨', rarity: 5}, {emoji: 'üêê', name: 'ÌÇ§Î©îÎùº', specialName: 'ÌôòÏÉÅÏùò Ï°∞Ìï©', rarity: 5}, {emoji: 'üßú‚Äç‚ôÄÔ∏è', name: 'Ïù∏Ïñ¥', specialName: 'Î∞îÎã§Ïùò ÎÖ∏Îûò', rarity: 5}, {emoji: 'üëæ', name: 'Ïô∏Í≥ÑÏù∏', specialName: 'ÎØ∏ÏßÄÏùò Î∞©Î¨∏Ïûê', rarity: 5},
            {emoji: 'üåü', name: 'Î≥ÑÏùò Ï†ïÎ†π', specialName: 'Ïö∞Ï£ºÏùò ÏÜçÏÇ≠ÏûÑ', rarity: 6}, {emoji: '‚òÄÔ∏è', name: 'ÌÉúÏñëÏùò ÌôîÏã†', specialName: 'Î™®Îì† ÎπõÏùò Í∑ºÏõê', rarity: 6}, {emoji: 'üåô', name: 'Îã¨Ïùò ÏàòÌò∏Ïûê', specialName: 'Î∞§ÌïòÎäòÏùò Îàà', rarity: 6}, {emoji: 'üå≥', name: 'ÏÑ∏Í≥ÑÏàò', specialName: 'ÏÇ¥ÏïÑÏûàÎäî ÎåÄÏßÄ', rarity: 6}, {emoji: 'üåä', name: 'ÎåÄÏñëÏùò Ìòº', specialName: 'Î™®Îì† Î¨ºÏùò ÏãúÏûë', rarity: 6}, {emoji: 'üå™Ô∏è', name: 'Ìè≠ÌíçÏùò Îàà', specialName: 'ÌïòÎäòÏùò Î∂ÑÎÖ∏', rarity: 6}, {emoji: 'üíé', name: 'Î≥¥ÏÑù Í≥®Î†ò', specialName: 'ÏòÅÏõêÏùò Í≤∞Ï†ïÏ≤¥', rarity: 6}, {emoji: 'üåå', name: 'ÏùÄÌïòÎ£°', specialName: 'Î≥ÑÏùÑ ÏÇºÌÇ§Îäî Ïûê', rarity: 6}, {emoji: '‚è≥', name: 'ÏãúÍ∞ÑÏùò Î™®ÎûòÏãúÍ≥Ñ', specialName: 'Í≥ºÍ±∞ÏôÄ ÎØ∏ÎûòÏùò Ï£ºÏù∏', rarity: 6}, {emoji: 'ü§ñ', name: 'Í∂ÅÍ∑πÏùò Î°úÎ¥á', specialName: 'ÎØ∏ÎûòÏùò ÏßÄÎ∞∞Ïûê', rarity: 6}
        ];
        
        const quizWords = [
            { question: 'ÏÇ¨Í≥º', answer: 'apple', options: ['banana', 'orange', 'grape', 'water'] }, { question: 'Í∞ÄÎ∞©', answer: 'bag', options: ['book', 'pen', 'desk', 'chair'] }, { question: 'Í≥µ', answer: 'ball', options: ['doll', 'car', 'toy', 'game'] }, { question: 'Ïπ®ÎåÄ', answer: 'bed', options: ['desk', 'chair', 'table', 'sofa'] }, { question: 'ÏûêÏ†ÑÍ±∞', answer: 'bike', options: ['car', 'bus', 'train', 'boat'] }, { question: 'ÏÉà', answer: 'bird', options: ['dog', 'cat', 'fish', 'lion'] }, { question: 'Î≥¥Ìä∏', answer: 'boat', options: ['car', 'bus', 'train', 'plane'] }, { question: 'Ï±Ö', answer: 'book', options: ['pen', 'note', 'desk', 'paper'] }, { question: 'ÏÉÅÏûê', answer: 'box', options: ['bag', 'desk', 'chair', 'bed'] }, { question: 'ÏÜåÎÖÑ', answer: 'boy', options: ['girl', 'man', 'woman', 'baby'] }, { question: 'Îπµ', answer: 'bread', options: ['milk', 'cheese', 'rice', 'water'] }, { question: 'Î≤ÑÏä§', answer: 'bus', options: ['car', 'train', 'bike', 'taxi'] }, { question: 'ÏûêÎèôÏ∞®', answer: 'car', options: ['bus', 'train', 'bike', 'plane'] }, { question: 'Í≥†ÏñëÏù¥', answer: 'cat', options: ['dog', 'bird', 'fish', 'hamster'] }, { question: 'ÏùòÏûê', answer: 'chair', options: ['desk', 'table', 'bed', 'sofa'] }, { question: 'ÎèÑÏãú', answer: 'city', options: ['town', 'country', 'village', 'island'] }, { question: 'ÏãúÍ≥Ñ', answer: 'clock', options: ['watch', 'timer', 'calendar', 'time'] }, { question: 'Íµ¨Î¶Ñ', answer: 'cloud', options: ['sun', 'moon', 'star', 'sky'] }, { question: 'Ïª¥Ìì®ÌÑ∞', answer: 'computer', options: ['tv', 'phone', 'radio', 'camera'] }, { question: 'ÏÜå', answer: 'cow', options: ['pig', 'sheep', 'horse', 'goat'] }, { question: 'Ïªµ', answer: 'cup', options: ['glass', 'bowl', 'plate', 'bottle'] }, { question: 'ÎÇÆ', answer: 'day', options: ['night', 'morning', 'evening', 'time'] }, { question: 'Ï±ÖÏÉÅ', answer: 'desk', options: ['chair', 'table', 'bed', 'sofa'] }, { question: 'Í∞ú', answer: 'dog', options: ['cat', 'bird', 'fish', 'rabbit'] }, { question: 'Ïù∏Ìòï', answer: 'doll', options: ['ball', 'toy', 'game', 'robot'] }, { question: 'Î¨∏', answer: 'door', options: ['window', 'wall', 'floor', 'roof'] }, { question: 'Ïò§Î¶¨', answer: 'duck', options: ['chicken', 'bird', 'goose', 'swan'] }, { question: 'Í≥ÑÎûÄ', answer: 'egg', options: ['milk', 'bread', 'cheese', 'meat'] }, { question: 'Îàà', answer: 'eye', options: ['nose', 'mouth', 'ear', 'face'] }, { question: 'ÏñºÍµ¥', answer: 'face', options: ['head', 'hair', 'eye', 'nose'] }, { question: 'ÎÜçÏû•', answer: 'farm', options: ['field', 'garden', 'forest', 'house'] }, { question: 'ÏïÑÎπ†', answer: 'father', options: ['mother', 'son', 'daughter', 'family'] }, { question: 'Î¨ºÍ≥†Í∏∞', answer: 'fish', options: ['bird', 'dog', 'cat', 'frog'] }, { question: 'ÍΩÉ', answer: 'flower', options: ['tree', 'leaf', 'grass', 'plant'] }, { question: 'ÏùåÏãù', answer: 'food', options: ['water', 'drink', 'snack', 'meal'] }, { question: 'Î∞ú', answer: 'foot', options: ['hand', 'leg', 'arm', 'head'] }, { question: 'ÏπúÍµ¨', answer: 'friend', options: ['family', 'teacher', 'student', 'neighbor'] }, { question: 'Í∞úÍµ¨Î¶¨', answer: 'frog', options: ['snake', 'lizard', 'turtle', 'fish'] }, { question: 'Í≤åÏûÑ', answer: 'game', options: ['sport', 'play', 'toy', 'hobby'] }, { question: 'Ï†ïÏõê', answer: 'garden', options: ['park', 'forest', 'field', 'yard'] }, { question: 'ÏÜåÎÖÄ', answer: 'girl', options: ['boy', 'woman', 'man', 'baby'] }, { question: 'Ïú†Î¶¨', answer: 'glass', options: ['cup', 'bottle', 'bowl', 'plate'] }, { question: 'ÏÜê', answer: 'hand', options: ['foot', 'arm', 'leg', 'finger'] }, { question: 'Î™®Ïûê', answer: 'hat', options: ['cap', 'helmet', 'scarf', 'glove'] }, { question: 'Î®∏Î¶¨', answer: 'head', options: ['face', 'hair', 'eye', 'ear'] }, { question: 'Ïßë', answer: 'house', options: ['home', 'school', 'store', 'office'] }, { question: 'ÏñºÏùå', answer: 'ice', options: ['water', 'snow', 'fire', 'hot'] }, { question: 'ÏÑ¨', answer: 'island', options: ['beach', 'sea', 'ocean', 'land'] }, { question: 'Ï£ºÏä§', answer: 'juice', options: ['water', 'milk', 'soda', 'tea'] }, { question: 'Ïó¥Ïá†', answer: 'key', options: ['lock', 'door', 'box', 'safe'] }, { question: 'Ïôï', answer: 'king', options: ['queen', 'prince', 'princess', 'castle'] }, { question: 'Îã§Î¶¨', answer: 'leg', options: ['arm', 'foot', 'hand', 'body'] }, { question: 'Ìé∏ÏßÄ', answer: 'letter', options: ['mail', 'card', 'email', 'word'] }, { question: 'ÏÇ¨Ïûê', answer: 'lion', options: ['tiger', 'bear', 'wolf', 'fox'] }, { question: 'ÎÇ®Ïûê', answer: 'man', options: ['woman', 'boy', 'girl', 'person'] }, { question: 'ÏßÄÎèÑ', answer: 'map', options: ['road', 'city', 'country', 'world'] }, { question: 'Í≥†Í∏∞', answer: 'meat', options: ['fish', 'chicken', 'pork', 'beef'] }, { question: 'Ïö∞Ïú†', answer: 'milk', options: ['water', 'juice', 'cheese', 'yogurt'] }, { question: 'Îèà', answer: 'money', options: ['coin', 'bill', 'cash', 'price'] }, { question: 'ÏõêÏà≠Ïù¥', answer: 'monkey', options: ['gorilla', 'chimp', 'banana', 'jungle'] }, { question: 'Îã¨', answer: 'moon', options: ['sun', 'star', 'sky', 'night'] }, { question: 'ÏïÑÏπ®', answer: 'morning', options: ['evening', 'afternoon', 'night', 'day'] }, { question: 'ÏóÑÎßà', answer: 'mother', options: ['father', 'son', 'daughter', 'parent'] }, { question: 'Ïù¥Î¶Ñ', answer: 'name', options: ['age', 'address', 'phone', 'word'] }, { question: 'Î∞§', answer: 'night', options: ['day', 'morning', 'evening', 'dark'] }, { question: 'ÏΩî', answer: 'nose', options: ['eye', 'mouth', 'ear', 'smell'] }, { question: 'Í≥µÏ±Ö', answer: 'note', options: ['book', 'paper', 'pen', 'pencil'] }, { question: 'Ïò§Î†åÏßÄ', answer: 'orange', options: ['apple', 'banana', 'grape', 'lemon'] }, { question: 'Í≥µÏõê', answer: 'park', options: ['garden', 'playground', 'field', 'forest'] }, { question: 'Ìéú', answer: 'pen', options: ['pencil', 'marker', 'crayon', 'write'] }, { question: 'Ïó∞ÌïÑ', answer: 'pencil', options: ['pen', 'eraser', 'ruler', 'draw'] }, { question: 'ÎèºÏßÄ', answer: 'pig', options: ['cow', 'sheep', 'horse', 'farm'] }, { question: 'ÎπÑÌñâÍ∏∞', answer: 'plane', options: ['car', 'bus', 'train', 'sky'] }, { question: 'ÏãùÎ¨º', answer: 'plant', options: ['tree', 'flower', 'leaf', 'root'] }, { question: 'Ïó¨Ïôï', answer: 'queen', options: ['king', 'princess', 'prince', 'crown'] }, { question: 'ÌÜ†ÎÅº', answer: 'rabbit', options: ['hare', 'carrot', 'jump', 'pet'] }, { question: 'ÎπÑ', answer: 'rain', options: ['snow', 'sun', 'cloud', 'weather'] }, { question: 'Ï•ê', answer: 'rat', options: ['mouse', 'cheese', 'hole', 'trap'] }, { question: 'Î∞òÏßÄ', answer: 'ring', options: ['necklace', 'bracelet', 'earring', 'gold'] }, { question: 'Í∞ï', answer: 'river', options: ['sea', 'lake', 'ocean', 'water'] }, { question: 'Í∏∏', answer: 'road', options: ['street', 'way', 'path', 'drive'] }, { question: 'Î°úÎ¥á', answer: 'robot', options: ['machine', 'computer', 'toy', 'future'] }, { question: 'ÌïôÍµê', answer: 'school', options: ['class', 'student', 'teacher', 'study'] }, { question: 'Î∞îÎã§', answer: 'sea', options: ['ocean', 'river', 'lake', 'beach'] }, { question: 'Ïñë', answer: 'sheep', options: ['goat', 'cow', 'farm', 'wool'] }, { question: 'Î∞∞', answer: 'ship', options: ['boat', 'sea', 'port', 'sail'] }, { question: 'Ïã†Î∞ú', answer: 'shoe', options: ['boot', 'sandal', 'sock', 'foot'] }, { question: 'ÌïòÎäò', answer: 'sky', options: ['sun', 'moon', 'cloud', 'blue'] }, { question: 'Îàà', answer: 'snow', options: ['rain', 'ice', 'winter', 'white'] }, { question: 'ÎÖ∏Îûò', answer: 'song', options: ['music', 'sing', 'dance', 'voice'] }, { question: 'Î≥Ñ', answer: 'star', options: ['sun', 'moon', 'sky', 'night'] }, { question: 'Îèå', answer: 'stone', options: ['rock', 'sand', 'hard', 'build'] }, { question: 'Í∞ÄÍ≤å', answer: 'store', options: ['shop', 'market', 'buy', 'sell'] }, { question: 'Ìï¥', answer: 'sun', options: ['moon', 'star', 'sky', 'day'] }, { question: 'ÏãùÌÉÅ', answer: 'table', options: ['desk', 'chair', 'eat', 'food'] }, { question: 'Ìò∏ÎûëÏù¥', answer: 'tiger', options: ['lion', 'cat', 'zoo', 'stripe'] }, { question: 'Ïû•ÎÇúÍ∞ê', answer: 'toy', options: ['doll', 'ball', 'game', 'play'] }, { question: 'Í∏∞Ï∞®', answer: 'train', options: ['bus', 'car', 'station', 'track'] }, { question: 'ÎÇòÎ¨¥', answer: 'tree', options: ['plant', 'flower', 'leaf', 'forest'] }, { question: 'Î¨º', answer: 'water', options: ['drink', 'sea', 'river', 'rain'] }, { question: 'Ï∞ΩÎ¨∏', answer: 'window', options: ['door', 'wall', 'glass', 'open'] }, { question: 'Ïó¨Ïûê', answer: 'woman', options: ['man', 'girl', 'boy', 'person'] }, { question: 'ÏÑ∏ÏÉÅ', answer: 'world', options: ['earth', 'country', 'people', 'map'] }, { question: 'ÎèôÎ¨ºÏõê', answer: 'zoo', options: ['animal', 'park', 'cage', 'lion'] },
            { question: 'Î¨ªÎã§', answer: 'ask', options: ['answer', 'tell', 'say', 'speak'] }, { question: 'Ïò§Îã§', answer: 'come', options: ['go', 'walk', 'run', 'arrive'] }, { question: 'ÏûêÎ•¥Îã§', answer: 'cut', options: ['break', 'tear', 'slice', 'chop'] }, { question: 'Ï∂§Ï∂îÎã§', answer: 'dance', options: ['sing', 'jump', 'move', 'music'] }, { question: 'ÌïòÎã§', answer: 'do', options: ['make', 'work', 'play', 'act'] }, { question: 'Í∑∏Î¶¨Îã§', answer: 'draw', options: ['paint', 'write', 'color', 'picture'] }, { question: 'ÎßàÏãúÎã§', answer: 'drink', options: ['eat', 'swallow', 'sip', 'water'] }, { question: 'Ïö¥Ï†ÑÌïòÎã§', answer: 'drive', options: ['ride', 'walk', 'fly', 'car'] }, { question: 'Î®πÎã§', answer: 'eat', options: ['drink', 'bite', 'chew', 'food'] }, { question: 'Ï∞æÎã§', answer: 'find', options: ['lose', 'search', 'look', 'get'] }, { question: 'ÎÇ†Îã§', answer: 'fly', options: ['jump', 'run', 'swim', 'plane'] }, { question: 'ÏñªÎã§', answer: 'get', options: ['give', 'take', 'receive', 'have'] }, { question: 'Ï£ºÎã§', answer: 'give', options: ['get', 'take', 'send', 'offer'] }, { question: 'Í∞ÄÎã§', answer: 'go', options: ['come', 'walk', 'run', 'leave'] }, { question: 'Í∞ÄÏßÄÎã§', answer: 'have', options: ['get', 'own', 'hold', 'possess'] }, { question: 'Îì£Îã§', answer: 'hear', options: ['listen', 'sound', 'voice', 'ear'] }, { question: 'ÎèïÎã§', answer: 'help', options: ['assist', 'support', 'work', 'aid'] }, { question: 'ÏπòÎã§', answer: 'hit', options: ['strike', 'beat', 'punch', 'touch'] }, { question: 'Ï†êÌîÑÌïòÎã§', answer: 'jump', options: ['hop', 'leap', 'fly', 'run'] }, { question: 'ÏïåÎã§', answer: 'know', options: ['think', 'learn', 'see', 'understand'] }, { question: 'Î∞∞Ïö∞Îã§', answer: 'learn', options: ['study', 'teach', 'know', 'read'] }, { question: 'Ï¢ãÏïÑÌïòÎã§', answer: 'like', options: ['love', 'hate', 'enjoy', 'prefer'] }, { question: 'Îì£Îã§(Ï£ºÏùòÍπäÍ≤å)', answer: 'listen', options: ['hear', 'sound', 'music', 'ear'] }, { question: 'ÏÇ¥Îã§', answer: 'live', options: ['stay', 'be', 'exist', 'house'] }, { question: 'Î≥¥Îã§', answer: 'look', options: ['see', 'watch', 'view', 'eye'] }, { question: 'ÏÇ¨ÎûëÌïòÎã§', answer: 'love', options: ['like', 'hate', 'adore', 'care'] }, { question: 'ÎßåÎì§Îã§', answer: 'make', options: ['do', 'create', 'build', 'form'] }, { question: 'ÎßåÎÇòÎã§', answer: 'meet', options: ['see', 'greet', 'find', 'friend'] }, { question: 'Ïó¥Îã§', answer: 'open', options: ['close', 'shut', 'start', 'door'] }, { question: 'ÎÜÄÎã§', answer: 'play', options: ['work', 'study', 'game', 'toy'] }, { question: 'ÎÜìÎã§', answer: 'put', options: ['place', 'set', 'move', 'lay'] }, { question: 'ÏùΩÎã§', answer: 'read', options: ['write', 'study', 'book', 'letter'] }, { question: 'ÌÉÄÎã§', answer: 'ride', options: ['drive', 'walk', 'bike', 'horse'] }, { question: 'Îã¨Î¶¨Îã§', answer: 'run', options: ['walk', 'jog', 'race', 'fast'] }, { question: 'ÎßêÌïòÎã§', answer: 'say', options: ['tell', 'speak', 'talk', 'ask'] }, { question: 'Î≥¥Îã§', answer: 'see', options: ['look', 'watch', 'view', 'eye'] }, { question: 'ÎÖ∏ÎûòÌïòÎã§', answer: 'sing', options: ['dance', 'shout', 'music', 'song'] }, { question: 'ÏïâÎã§', answer: 'sit', options: ['stand', 'lie', 'chair', 'down'] }, { question: 'ÏûêÎã§', answer: 'sleep', options: ['wake', 'rest', 'dream', 'bed'] }, { question: 'ÎßêÌïòÎã§', answer: 'speak', options: ['talk', 'say', 'tell', 'language'] }, { question: 'ÏÑúÎã§', answer: 'stand', options: ['sit', 'lie', 'up', 'walk'] }, { question: 'Î©àÏ∂îÎã§', answer: 'stop', options: ['start', 'go', 'finish', 'end'] }, { question: 'Í≥µÎ∂ÄÌïòÎã§', answer: 'study', options: ['learn', 'read', 'write', 'school'] }, { question: 'ÏàòÏòÅÌïòÎã§', answer: 'swim', options: ['dive', 'float', 'water', 'pool'] }, { question: 'Í∞ÄÏ†∏Í∞ÄÎã§', answer: 'take', options: ['get', 'give', 'bring', 'hold'] }, { question: 'ÎßêÌïòÎã§', answer: 'talk', options: ['speak', 'say', 'chat', 'discuss'] }, { question: 'ÏÉùÍ∞ÅÌïòÎã§', answer: 'think', options: ['know', 'believe', 'guess', 'idea'] }, { question: 'Í±∑Îã§', answer: 'walk', options: ['run', 'go', 'step', 'foot'] }, { question: 'ÏõêÌïòÎã§', answer: 'want', options: ['need', 'wish', 'like', 'desire'] }, { question: 'Ïì∞Îã§', answer: 'write', options: ['read', 'draw', 'pen', 'letter'] },
            { question: 'ÌôîÎÇú', answer: 'angry', options: ['happy', 'sad', 'mad', 'upset'] }, { question: 'ÎÇòÏÅú', answer: 'bad', options: ['good', 'wrong', 'evil', 'poor'] }, { question: 'ÌÅ∞', answer: 'big', options: ['small', 'large', 'huge', 'great'] }, { question: 'Í≤ÄÏùÄÏÉâ', answer: 'black', options: ['white', 'red', 'blue', 'dark'] }, { question: 'ÌååÎûÄÏÉâ', answer: 'blue', options: ['red', 'yellow', 'green', 'sky'] }, { question: 'Í∞àÏÉâ', answer: 'brown', options: ['black', 'white', 'tan', 'wood'] }, { question: 'Íπ®ÎÅóÌïú', answer: 'clean', options: ['dirty', 'wash', 'clear', 'neat'] }, { question: 'Ï∂îÏö¥', answer: 'cold', options: ['hot', 'cool', 'warm', 'ice'] }, { question: 'Ïñ¥ÎëêÏö¥', answer: 'dark', options: ['light', 'bright', 'black', 'night'] }, { question: 'ÎçîÎü¨Ïö¥', answer: 'dirty', options: ['clean', 'messy', 'mud', 'dust'] }, { question: 'ÎßàÎ•∏', answer: 'dry', options: ['wet', 'water', 'towel', 'sand'] }, { question: 'Ïâ¨Ïö¥', answer: 'easy', options: ['hard', 'simple', 'difficult', 'soft'] }, { question: 'Îπ†Î•∏', answer: 'fast', options: ['slow', 'quick', 'run', 'speed'] }, { question: 'Îö±Îö±Ìïú', answer: 'fat', options: ['thin', 'big', 'heavy', 'plump'] }, { question: 'Ï¢ãÏùÄ', answer: 'good', options: ['bad', 'great', 'nice', 'fine'] }, { question: 'Ï¥àÎ°ùÏÉâ', answer: 'green', options: ['red', 'blue', 'yellow', 'grass'] }, { question: 'ÌñâÎ≥µÌïú', answer: 'happy', options: ['sad', 'glad', 'joy', 'smile'] }, { question: 'Ïñ¥Î†§Ïö¥', answer: 'hard', options: ['easy', 'soft', 'difficult', 'tough'] }, { question: 'Î¨¥Í±∞Ïö¥', answer: 'heavy', options: ['light', 'big', 'stone', 'lift'] }, { question: 'Îú®Í±∞Ïö¥', answer: 'hot', options: ['cold', 'warm', 'fire', 'sun'] }, { question: 'ÌÅ∞', answer: 'large', options: ['small', 'big', 'huge', 'wide'] }, { question: 'Í∞ÄÎ≤ºÏö¥', answer: 'light', options: ['heavy', 'dark', 'bright', 'easy'] }, { question: 'Í∏¥', answer: 'long', options: ['short', 'tall', 'big', 'line'] }, { question: 'ÏÉàÎ°úÏö¥', answer: 'new', options: ['old', 'young', 'fresh', 'modern'] }, { question: 'Ïò§ÎûòÎêú', answer: 'old', options: ['new', 'young', 'ancient', 'age'] }, { question: 'ÌïòÎÇò', answer: 'one', options: ['two', 'three', 'four', 'first'] }, { question: 'Ï£ºÌô©ÏÉâ', answer: 'orange', options: ['yellow', 'red', 'fruit', 'color'] }, { question: 'Í∞ÄÎÇúÌïú', answer: 'poor', options: ['rich', 'needy', 'money', 'bad'] }, { question: 'ÏòàÏÅú', answer: 'pretty', options: ['beautiful', 'cute', 'ugly', 'nice'] }, { question: 'ÏûêÏ£ºÏÉâ', answer: 'purple', options: ['violet', 'grape', 'flower', 'color'] }, { question: 'Îπ†Î•∏', answer: 'quick', options: ['fast', 'slow', 'rapid', 'swift'] }, { question: 'Ï°∞Ïö©Ìïú', answer: 'quiet', options: ['loud', 'silent', 'calm', 'soft'] }, { question: 'Îπ®Í∞ÑÏÉâ', answer: 'red', options: ['blue', 'yellow', 'green', 'apple'] }, { question: 'Î∂ÄÏú†Ìïú', answer: 'rich', options: ['poor', 'wealthy', 'money', 'gold'] }, { question: 'Ïä¨Ìîà', answer: 'sad', options: ['happy', 'unhappy', 'cry', 'tear'] }, { question: 'ÏßßÏùÄ', answer: 'short', options: ['long', 'tall', 'small', 'brief'] }, { question: 'ÏïÑÌîà', answer: 'sick', options: ['ill', 'well', 'healthy', 'pain'] }, { question: 'ÎäêÎ¶∞', answer: 'slow', options: ['fast', 'quick', 'late', 'walk'] }, { question: 'ÏûëÏùÄ', answer: 'small', options: ['big', 'little', 'tiny', 'short'] }, { question: 'Î∂ÄÎìúÎü¨Ïö¥', answer: 'soft', options: ['hard', 'gentle', 'smooth', 'fluffy'] }, { question: 'Í∞ïÌïú', answer: 'strong', options: ['weak', 'powerful', 'tough', 'hard'] }, { question: 'ÌÇ§Í∞Ä ÌÅ∞', answer: 'tall', options: ['short', 'long', 'high', 'big'] }, { question: 'ÎßàÎ•∏', answer: 'thin', options: ['fat', 'slim', 'narrow', 'light'] }, { question: 'Î™ªÏÉùÍ∏¥', answer: 'ugly', options: ['pretty', 'beautiful', 'bad', 'horrible'] }, { question: 'Îî∞ÎúªÌïú', answer: 'warm', options: ['hot', 'cold', 'cool', 'sun'] }, { question: 'ÏïΩÌïú', answer: 'weak', options: ['strong', 'feeble', 'frail', 'sick'] }, { question: 'Ï†ñÏùÄ', answer: 'wet', options: ['dry', 'damp', 'water', 'rain'] }, { question: 'Ìù∞ÏÉâ', answer: 'white', options: ['black', 'red', 'snow', 'light'] }, { question: 'Ïñ¥Î¶∞', answer: 'young', options: ['old', 'new', 'child', 'baby'] }, { question: 'ÎÖ∏ÎûÄÏÉâ', answer: 'yellow', options: ['red', 'blue', 'sun', 'lemon'] }
        ];

        const shopItems = [
            { name: 'Îπ®Í∞Ñ Î≤Ω', emoji: 'üü•', price: 15 }, { name: 'ÌååÎûÄ Î≤Ω', emoji: 'üü¶', price: 15 }, { name: 'Ï¥àÎ°ù Î≤Ω', emoji: 'ÔøΩ', price: 15 }, { name: 'ÎÖ∏ÎûÄ Î≤Ω', emoji: 'üü®', price: 15 }, { name: 'ÌïòÏñÄ Î≤Ω', emoji: '‚¨ú', price: 15 }, { name: 'Í≤ÄÏùÄ Î≤Ω', emoji: '‚¨õ', price: 15 }, { name: 'Ï£ºÌô© Î≤Ω', emoji: 'üüß', price: 15 }, { name: 'Î≥¥Îùº Î≤Ω', emoji: 'üü™', price: 15 }, { name: 'Í∞àÏÉâ Î≤Ω', emoji: 'üü´', price: 15 },
            { name: 'ÏÉàÏãπ', emoji: 'üå±', price: 25 }, { name: 'ÏûêÍ∞àÍ∏∏', emoji: 'ü™®', price: 35 }, { name: 'Ìï¥Î∞îÎùºÍ∏∞', emoji: 'üåª', price: 40 }, { name: 'Ìä§Î¶Ω', emoji: 'üå∑', price: 45 }, { name: 'ÍΩÉ', emoji: 'üå∏', price: 50 }, { name: 'Îç§Î∂à', emoji: 'üåø', price: 55 }, { name: 'Î≤ÑÏÑØ', emoji: 'üçÑ', price: 60 }, { name: 'Î∞Ä', emoji: 'üåæ', price: 65 }, { name: 'ÎÑ§ÏûéÌÅ¥Î°úÎ≤Ñ', emoji: 'üçÄ', price: 75 }, { name: 'ÏÑ†Ïù∏Ïû•', emoji: 'üåµ', price: 80 },
            { name: 'Í∏∏', emoji: 'üõ§Ô∏è', price: 80 }, { name: 'ÍΩÉÎ∞≠', emoji: 'üíê', price: 90 }, { name: 'ÎÇòÎ¨¥', emoji: 'üå≥', price: 100 }, { name: 'Ïö∞Ï≤¥ÌÜµ', emoji: 'üìÆ', price: 110 }, { name: 'Ï±ÑÏÜåÎ∞≠', emoji: 'ü•ï', price: 120 }, { name: 'ÌóàÏàòÏïÑÎπÑ', emoji: 'üßç', price: 130 }, { name: 'ÏÉÅÎ°ùÏàò', emoji: 'üå≤', price: 150 }, { name: 'Ïö∏ÌÉÄÎ¶¨', emoji: 'üöß', price: 150 }, { name: 'Î≤åÏßë', emoji: 'üêù', price: 160 }, { name: 'Î≤öÎÇòÎ¨¥', emoji: 'üå∏', price: 180 }, { name: 'Ï∫†ÌîÑÌååÏù¥Ïñ¥', emoji: 'üî•', price: 180 }, { name: 'Îã®ÌíçÎÇòÎ¨¥', emoji: 'üçÅ', price: 190 }, { name: 'ÏïºÏûêÏàò', emoji: 'üå¥', price: 200 }, { name: 'Í∞ÄÎ°úÎì±', emoji: 'üí°', price: 220 }, { name: 'Î≤§Ïπò', emoji: 'ü™ë', price: 250 }, { name: 'Ïö∞Î¨º', emoji: 'üï≥Ô∏è', price: 280 }, { name: 'Ïó∞Î™ª', emoji: 'üíß', price: 300 },
            { name: 'Î≥¥Î¨ºÏÉÅÏûê', emoji: 'üéÅ', price: 350 }, { name: 'Î∂ÑÏàò', emoji: '‚õ≤', price: 400 }, { name: 'Ï≤úÎßâ', emoji: '‚õ∫', price: 450 }, { name: 'Ïßë', emoji: 'üè†', price: 500 }, { name: 'Ïò®Ïã§', emoji: 'üè°', price: 600 }, { name: 'Îã§Î¶¨', emoji: 'üåâ', price: 800 }, { name: 'ÏÑ±', emoji: 'üè∞', price: 1000 }, { name: 'ÌöåÏ†ÑÎ™©Îßà', emoji: 'üé†', price: 1200 }, { name: 'Î¨¥ÏßÄÍ∞ú', emoji: 'üåà', price: 1500 }, { name: 'Î≥ÑÎò•Î≥Ñ', emoji: 'üå†', price: 2000 }
        ];

        const synthesisRecipes = [
            { result: 'Í∑∏Î¶¨ÌïÄ', ingredients: ['ÏÇ¨Ïûê', 'ÎèÖÏàòÎ¶¨'] },
            { result: 'ÌéòÍ∞ÄÏàòÏä§', ingredients: ['Îßê', 'Î∞±Ï°∞'] },
            { result: 'ÌÇ§Î©îÎùº', ingredients: ['ÏóºÏÜå', 'ÏÇ¨Ïûê'] },
            { result: 'ÌûàÎìúÎùº', ingredients: ['Î±Ä', 'Ïö©'] },
            { result: 'Ïú†ÎãàÏΩò', ingredients: ['Îßê', 'ÏÇ¨Ïä¥'] },
            { result: 'Î∂àÏÇ¨Ï°∞', ingredients: ['ÎèÖÏàòÎ¶¨', 'Ïö©'] },
            { result: 'ÎèôÏñëÏö©', ingredients: ['Î±Ä', 'Î¨ºÍ≥†Í∏∞'] },
            { result: 'ÌéúÎ¶¨Î•¥', ingredients: ['ÎäëÎåÄ', 'Í≥∞'] },
            { result: 'Ïù∏Ïñ¥', ingredients: ['ÎèåÍ≥†Îûò', 'ÏõêÏà≠Ïù¥'] },
            { result: 'ÌïòÌîº', ingredients: ['ÏÉà', 'Î∞ïÏ•ê'] },
            { result: 'ÎåÄÏôïÏò§ÏßïÏñ¥', ingredients: ['Ïò§ÏßïÏñ¥', 'Î¨∏Ïñ¥'] },
            { result: 'Î∞±Ìò∏', ingredients: ['Ìò∏ÎûëÏù¥', 'Î∂ÅÍ∑πÍ≥∞'] },
            { result: 'ÌùëÌëúÎ≤î', ingredients: ['ÌëúÎ≤î', 'ÎäëÎåÄ'] },
            { result: 'Îß§Î®∏Îìú', ingredients: ['ÏΩîÎÅºÎ¶¨', 'Î©ßÎèºÏßÄ'] },
            { result: 'Ìã∞ÎùºÎÖ∏ÏÇ¨Ïö∞Î£®Ïä§', ingredients: ['ÏïÖÏñ¥', 'Îã≠'] },
            { result: 'Î∏åÎùºÌÇ§Ïò§ÏÇ¨Ïö∞Î£®Ïä§', ingredients: ['Í∏∞Î¶∞', 'ÏÜå'] },
            { result: 'Î≥¥ÏÑù Í≥®Î†ò', ingredients: ['Í±∞Î∂ÅÏù¥', 'Í≤å'] },
            { result: 'Î≥ÑÏùò Ï†ïÎ†π', ingredients: ['ÎÇòÎπÑ', 'Ïò¨ÎπºÎØ∏'] },
            { result: 'ÏùÄÌïòÎ£°', ingredients: ['Ïö©', 'Í≥†Îûò'] },
            { result: 'Í∂ÅÍ∑πÏùò Î°úÎ¥á', ingredients: ['Í±∞ÎØ∏', 'Ï†ÑÍ∞à'] }
        ];


        // ==================== ÌïµÏã¨ Í≤åÏûÑ Ìï®Ïàò ====================
        
        // Îã®Ïñ¥ Î∞úÏùå Ïû¨ÏÉù Ìï®Ïàò
        function speakWord(word) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(word);
                const voices = window.speechSynthesis.getVoices();
                let englishVoice = voices.find(voice => voice.lang.startsWith('en-US')) || voices.find(voice => voice.lang.startsWith('en'));
                if (englishVoice) {
                    utterance.voice = englishVoice;
                }
                utterance.pitch = 1;
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            } else {
                alert("Ï£ÑÏÜ°Ìï©ÎãàÎã§. ÏÇ¨Ïö© Ï§ëÏù∏ Î∏åÎùºÏö∞Ï†ÄÏóêÏÑúÎäî ÏùåÏÑ± Ïû¨ÏÉùÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.");
            }
        }
        window.speechSynthesis.onvoiceschanged = () => {
            window.speechSynthesis.getVoices();
        };

        // ÏòÅÏñ¥ ÌÄ¥Ï¶à ÏÉùÏÑ± (ÎèôÎ¨º Ïû°Í∏∞)
        function generateEnglishQuiz() {
            const quizData = { ...quizWords[Math.floor(Math.random() * quizWords.length)] };
            currentEnglishQuiz = { answer: quizData.answer };

            document.getElementById('english-question').textContent = `"${quizData.question}"`;
            
            const speakBtn = document.getElementById('speak-button');
            speakBtn.onclick = () => speakWord(currentEnglishQuiz.answer);
            
            const wrongOptions = quizData.options.filter(opt => opt !== quizData.answer).sort(() => 0.5 - Math.random()).slice(0, 3);
            const finalOptions = [quizData.answer, ...wrongOptions].sort(() => Math.random() - 0.5);
            
            const optionsContainer = document.getElementById('english-options');
            optionsContainer.innerHTML = '';
            finalOptions.forEach(option => {
                const button = document.createElement('button');
                button.className = 'english-option-btn';
                button.innerText = option;
                button.onclick = () => checkEnglishQuizAnswer(option);
                optionsContainer.appendChild(button);
            });
            
            const feedback = document.getElementById('feedback');
            feedback.textContent = '';
            feedback.className = 'feedback';
        }

        // ÏòÅÏñ¥ ÌÄ¥Ï¶à Ï†ïÎãµ ÌôïÏù∏
        function checkEnglishQuizAnswer(selectedOption) {
            const optionsContainer = document.getElementById('english-options');
            optionsContainer.querySelectorAll('.english-option-btn').forEach(btn => {
                btn.disabled = true;
            });

            const feedback = document.getElementById('feedback');
            if (selectedOption === currentEnglishQuiz.answer) {
                speakWord(currentEnglishQuiz.answer);
                gameState.score += 10 * gameState.level;
                feedback.textContent = 'Ï†ïÎãµ! ÎèôÎ¨ºÏùÑ Ïû°ÏïòÏñ¥Ïöî! üéâ';
                feedback.className = 'feedback correct';
                
                const newAnimal = getRandomAnimal();
                addAnimal(newAnimal);
                
                if (gameState.score >= gameState.level * 50) {
                    gameState.level++;
                    showLevelUp();
                }
                
                saveCurrentUserData();
                setTimeout(generateEnglishQuiz, 1500);
            } else {
                feedback.textContent = `ÏïÑ! Ï†ïÎãµÏùÄ "${currentEnglishQuiz.answer}"ÏòÄÏñ¥Ïöî.`;
                feedback.className = 'feedback incorrect';
                setTimeout(generateEnglishQuiz, 2500);
            }
            updateUI();
        }

        // ÎèôÎ¨º Î†àÎ≤®ÏóÖÏùÑ ÏúÑÌïú ÏàòÌïô Î¨∏Ï†ú ÏÉùÏÑ±
        function generateMathProblemForLevelUp(animalLevel) {
            const difficulty = Math.min(Math.floor(animalLevel / 5) + 1, 4);
            let question = {};
            
            switch(difficulty) {
                case 1:
                    const a1 = Math.floor(Math.random() * 10) + 1;
                    const b1 = Math.floor(Math.random() * 10) + 1;
                    if (Math.random() > 0.5) { question = {text: `${a1} + ${b1}`, answer: a1 + b1}; } 
                    else { const l = Math.max(a1, b1), s = Math.min(a1, b1); question = {text: `${l} - ${s}`, answer: l - s}; }
                    break;
                case 2:
                    const a2 = Math.floor(Math.random() * 90) + 10;
                    const b2 = Math.floor(Math.random() * 90) + 10;
                    if (Math.random() > 0.5) { question = {text: `${a2} + ${b2}`, answer: a2 + b2}; }
                    else { const l = Math.max(a2, b2), s = Math.min(a2, b2); question = {text: `${l} - ${s}`, answer: l - s}; }
                    break;
                case 3:
                    const a3 = Math.floor(Math.random() * 8) + 2;
                    const b3 = Math.floor(Math.random() * 8) + 2;
                    question = {text: `${a3} √ó ${b3}`, answer: a3 * b3};
                    break;
                case 4:
                    const a4 = Math.floor(Math.random() * 900) + 100;
                    const b4 = Math.floor(Math.random() * 900) + 100;
                    if (Math.random() > 0.5) { question = {text: `${a4} + ${b4}`, answer: a4 + b4}; }
                    else { const l = Math.max(a4, b4), s = Math.min(a4, b4); question = {text: `${l} - ${s}`, answer: l - s}; }
                    break;
            }
            gameState.currentQuestion = question;
            document.getElementById('math-question').textContent = `${question.text} = ?`;
        }

        // ÏàòÌïô Î¨∏Ï†ú Î™®Îã¨ Ïó¥Í∏∞
        function startMathProblem(animalName) {
            const animal = gameState.animals[animalName];
            generateMathProblemForLevelUp(animal.animalLevel);
            
            const answerInput = document.getElementById('math-answer-input');
            const submitBtn = document.getElementById('math-submit-btn');
            
            answerInput.value = '';
            document.getElementById('math-feedback').textContent = '';
            
            answerInput.disabled = false;
            submitBtn.disabled = false;

            submitBtn.onclick = () => checkMathAnswer(animalName);
            document.getElementById('math-modal').style.display = 'flex';
            answerInput.focus();
        }

        // ÏàòÌïô Î¨∏Ï†ú Ï†ïÎãµ ÌôïÏù∏
        function checkMathAnswer(animalName) {
            const answerInput = document.getElementById('math-answer-input');
            const submitBtn = document.getElementById('math-submit-btn');
            const userAnswer = parseInt(answerInput.value);
            const feedback = document.getElementById('math-feedback');
            
            if (isNaN(userAnswer)) {
                feedback.textContent = 'Ïà´ÏûêÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!';
                feedback.style.color = 'red';
                return;
            }
            
            answerInput.disabled = true;
            submitBtn.disabled = true;

            if (userAnswer === gameState.currentQuestion.answer) {
                const animal = gameState.animals[animalName];
                gameState.score += 15 * animal.animalLevel;
                animal.animalLevel++;
                
                feedback.textContent = `Ï†ïÎãµ! ${animal.name}Ïùò Î†àÎ≤®Ïù¥ ${animal.animalLevel}Ïù¥ ÎêòÏóàÏñ¥Ïöî!`;
                feedback.style.color = 'green';

                updateUI();
                updateAnimalCollection();
                saveCurrentUserData();
                setTimeout(closeMathModal, 1500);
            } else {
                feedback.textContent = `Îï°! Îã§Ïãú ÏÉùÍ∞ÅÌï¥Î≥¥ÏÑ∏Ïöî.`;
                feedback.style.color = 'red';
                setTimeout(() => {
                    answerInput.disabled = false;
                    submitBtn.disabled = false;
                    answerInput.focus();
                }, 1000);
            }
        }

        function closeMathModal() {
            document.getElementById('math-modal').style.display = 'none';
        }

        function getRandomAnimal() {
            const maxRarity = Math.min(Math.floor(gameState.level / 2) + 1, 6);
            const availableAnimals = animalTypes.filter(animal => animal.rarity <= maxRarity);
            const weights = availableAnimals.map(animal => Math.pow(0.7, animal.rarity - 1));
            const totalWeight = weights.reduce((sum, weight) => sum + weight, 0);
            let random = Math.random() * totalWeight;
            for (let i = 0; i < availableAnimals.length; i++) {
                random -= weights[i];
                if (random <= 0) {
                    return availableAnimals[i];
                }
            }
            return availableAnimals[0];
        }

        function addAnimal(animal) {
            const key = animal.name;
            if (!gameState.animals[key]) {
                gameState.animals[key] = {
                    ...animal,
                    count: 0,
                    animalLevel: 1 
                };
                gameState.speciesCount++;
                showNewAnimalAlert(animal);
            }
            
            gameState.animals[key].count++;
            gameState.totalAnimals++;
            
            updateAnimalCollection();
        }

        // ==================== UI ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò ====================

        function updateUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('species-count').textContent = gameState.speciesCount;
            document.getElementById('total-animals').textContent = gameState.totalAnimals;
        }

        function updateAnimalCollection() {
            const collection = document.getElementById('animal-collection');
            if (!collection) return;
            collection.innerHTML = '';
            
            const sortedAnimals = Object.values(gameState.animals).sort((a, b) => b.rarity - a.rarity);
            
            sortedAnimals.forEach(animal => {
                if (animal.count === 0) return;

                const card = document.createElement('div');
                card.className = 'animal-card';
                
                let borderColor = '#87CEEB';
                if (animal.rarity >= 5) borderColor = '#FFD700';
                else if (animal.rarity >= 4) borderColor = '#9370DB';
                else if (animal.rarity >= 3) borderColor = '#32CD32';
                
                card.style.borderColor = borderColor;
                card.style.boxShadow = `0 6px 20px ${borderColor}40`;
                
                card.innerHTML = `
                    <span class="animal-emoji">${animal.emoji}</span>
                    <div class="animal-name">${animal.name} (${animal.count}ÎßàÎ¶¨)</div>
                    <div class="animal-level">Lv. ${animal.animalLevel || 1}</div>
                    <div class="special-name">"${animal.specialName}"</div>
                    <div class="rarity-badge">‚òÖ${animal.rarity}</div>
                `;
                
                card.onclick = () => startMathProblem(animal.name);
                collection.appendChild(card);
            });
        }
        
        function updateEncyclopedia() {
            const grid = document.getElementById('encyclopedia-grid');
            grid.innerHTML = '';

            const collectedCount = gameState.speciesCount;
            const totalCount = animalTypes.length;
            document.getElementById('collection-progress').textContent = `${collectedCount} / ${totalCount}`;
            
            const progressPercent = totalCount > 0 ? (collectedCount / totalCount) * 100 : 0;
            document.getElementById('progress-bar').style.width = `${progressPercent}%`;

            animalTypes.forEach(animal => {
                const collectedAnimal = gameState.animals[animal.name];
                const card = document.createElement('div');
                card.className = 'encyclopedia-card';
                
                if (collectedAnimal) {
                    card.innerHTML = `
                        <span class="animal-emoji">${animal.emoji}</span>
                        <div class="animal-name">${animal.name}</div>
                        <div class="animal-count">${collectedAnimal.count}ÎßàÎ¶¨ Î≥¥Ïú†</div>
                        <div class="rarity-badge">‚òÖ${animal.rarity}</div>
                    `;
                } else {
                    card.classList.add('uncollected');
                    card.innerHTML = `
                        <span class="animal-emoji">‚ùì</span>
                        <div class="animal-name">???</div>
                        <div class="animal-count">ÎØ∏Î∞úÍ≤¨</div>
                        <div class="rarity-badge">‚òÖ${animal.rarity}</div>
                    `;
                }
                grid.appendChild(card);
            });
        }

        // ==================== ÎÜçÏû• Í¥ÄÎ†® Ìï®Ïàò ====================
        
        function initializeFarm() {
            const farmGrid = document.getElementById('farm-grid');
            farmGrid.innerHTML = '';
            for (let i = 0; i < 48; i++) {
                const cell = document.createElement('div');
                cell.className = 'farm-cell';
                cell.dataset.index = i;
                cell.onclick = () => placeItemOnFarm(i);
                farmGrid.appendChild(cell);
            }
            updateShop();
            updateInventory();
            renderFarm();
        }

        function updateShop() {
            const shopGrid = document.getElementById('shop-grid');
            shopGrid.innerHTML = '';
            shopItems.forEach(item => {
                const shopItemDiv = document.createElement('div');
                shopItemDiv.className = 'shop-item';
                shopItemDiv.innerHTML = `
                    <div class="item-emoji">${item.emoji}</div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-price">üí∞ ${item.price}</div>
                `;
                shopItemDiv.onclick = () => buyItem(item.name);
                shopGrid.appendChild(shopItemDiv);
            });
        }

        function buyItem(itemName) {
            const item = shopItems.find(i => i.name === itemName);
            if (gameState.score >= item.price) {
                gameState.score -= item.price;
                if (!gameState.farm.items[itemName]) {
                    gameState.farm.items[itemName] = { ...item, count: 0 };
                }
                gameState.farm.items[itemName].count++;
                alert(`${itemName}ÏùÑ(Î•º) Íµ¨Îß§ÌñàÏäµÎãàÎã§!`);
                updateUI();
                updateInventory();
                saveCurrentUserData();
            } else {
                alert('Ï†êÏàòÍ∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§!');
            }
        }

        function updateInventory() {
            const inventoryGrid = document.getElementById('inventory-grid');
            inventoryGrid.innerHTML = '';
            Object.values(gameState.farm.items).forEach(item => {
                if (item.count > 0) {
                    const invItemDiv = document.createElement('div');
                    invItemDiv.className = 'inventory-item';
                    invItemDiv.dataset.itemName = item.name;
                    invItemDiv.innerHTML = `
                        <div class="item-emoji">${item.emoji}</div>
                        <div class="item-name">${item.name}</div>
                        <div class="item-count">x ${item.count}</div>
                    `;
                    invItemDiv.onclick = () => selectItemToPlace(item.name);
                    inventoryGrid.appendChild(invItemDiv);
                }
            });
            Object.values(gameState.animals).forEach(animal => {
                 if (animal.count > 0) {
                    const invItemDiv = document.createElement('div');
                    invItemDiv.className = 'inventory-item';
                    invItemDiv.dataset.itemName = animal.name;
                    invItemDiv.innerHTML = `
                        <div class="item-emoji">${animal.emoji}</div>
                        <div class="item-name">${animal.name}</div>
                        <div class="item-count">x ${animal.count}</div>
                    `;
                    invItemDiv.onclick = () => selectItemToPlace(animal.name, true);
                    inventoryGrid.appendChild(invItemDiv);
                }
            });
        }

        function selectItemToPlace(itemName, isAnimal = false) {
            selectedItemToPlace = { name: itemName, isAnimal };
            document.querySelectorAll('.inventory-item').forEach(el => el.classList.remove('selected'));
            document.querySelector(`.inventory-item[data-item-name="${itemName}"]`).classList.add('selected');
        }

        function placeItemOnFarm(index) {
            if (event.button === 2 || event.ctrlKey) {
                event.preventDefault();
                const currentCellContent = gameState.farm.layout[index];
                if (currentCellContent) {
                    if (currentCellContent.isAnimal) { gameState.animals[currentCellContent.name].count++; } 
                    else { gameState.farm.items[currentCellContent.name].count++; }
                    gameState.farm.layout[index] = null;
                    renderFarm();
                    updateInventory();
                    saveCurrentUserData();
                }
                return;
            }

            if (!selectedItemToPlace) return;

            const { name, isAnimal } = selectedItemToPlace;
            const currentCellContent = gameState.farm.layout[index];

            if (isAnimal) {
                if (gameState.animals[name].count > 0) {
                    if (currentCellContent) {
                         if (currentCellContent.isAnimal) gameState.animals[currentCellContent.name].count++;
                         else gameState.farm.items[currentCellContent.name].count++;
                    }
                    gameState.farm.layout[index] = { name, isAnimal: true, emoji: gameState.animals[name].emoji };
                    gameState.animals[name].count--;
                }
            } else {
                if (gameState.farm.items[name].count > 0) {
                    if (currentCellContent) {
                         if (currentCellContent.isAnimal) gameState.animals[currentCellContent.name].count++;
                         else gameState.farm.items[currentCellContent.name].count++;
                    }
                    gameState.farm.layout[index] = { name, isAnimal: false, emoji: gameState.farm.items[name].emoji };
                    gameState.farm.items[name].count--;
                }
            }
            
            selectedItemToPlace = null;
            renderFarm();
            updateInventory();
            saveCurrentUserData();
        }

        function renderFarm() {
            const farmGrid = document.getElementById('farm-grid');
            gameState.farm.layout.forEach((item, index) => {
                const cell = farmGrid.children[index];
                if (item) {
                    cell.innerHTML = `<span class="${item.isAnimal ? 'placed-animal' : ''}">${item.emoji}</span>`;
                } else {
                    cell.innerHTML = '';
                }
            });
        }
        
        // ==================== ÎèôÎ¨º Ìï©ÏÑ± Ìï®Ïàò ====================
        
        function updateSynthesisPage() {
            const grid = document.getElementById('synthesis-grid');
            grid.innerHTML = '';

            synthesisRecipes.forEach(recipe => {
                const [ing1, ing2] = recipe.ingredients;
                const result = animalTypes.find(a => a.name === recipe.result);

                const hasIng1 = gameState.animals[ing1] && gameState.animals[ing1].count > 0;
                const hasIng2 = gameState.animals[ing2] && gameState.animals[ing2].count > 0;
                const canSynthesize = hasIng1 && hasIng2;

                const ing1Data = animalTypes.find(a => a.name === ing1);
                const ing2Data = animalTypes.find(a => a.name === ing2);

                const card = document.createElement('div');
                card.className = 'synthesis-card';
                card.innerHTML = `
                    <div class="synthesis-ingredient ${hasIng1 ? 'owned' : 'not-owned'}">
                        <span class="animal-emoji">${ing1Data.emoji}</span>
                        <div>${ing1}</div>
                    </div>
                    <div class="synthesis-symbol">+</div>
                    <div class="synthesis-ingredient ${hasIng2 ? 'owned' : 'not-owned'}">
                        <span class="animal-emoji">${ing2Data.emoji}</span>
                        <div>${ing2}</div>
                    </div>
                    <div class="synthesis-symbol">=</div>
                    <div class="synthesis-result">
                        <span class="animal-emoji">${result.emoji}</span>
                        <div>${result.name}</div>
                    </div>
                    <button class="synthesis-btn" onclick="performSynthesis('${recipe.result}')" ${!canSynthesize ? 'disabled' : ''}>Ìï©ÏÑ±</button>
                `;
                grid.appendChild(card);
            });
        }

        function performSynthesis(resultName) {
            const recipe = synthesisRecipes.find(r => r.result === resultName);
            if (!recipe) return;

            const [ing1, ing2] = recipe.ingredients;
            const hasIng1 = gameState.animals[ing1] && gameState.animals[ing1].count > 0;
            const hasIng2 = gameState.animals[ing2] && gameState.animals[ing2].count > 0;

            if (hasIng1 && hasIng2) {
                if (confirm(`'${ing1}'ÏôÄ(Í≥º) '${ing2}'Î•º ÏÇ¨Ïö©Ìï¥ '${resultName}'ÏùÑ(Î•º) ÎßåÎìúÏãúÍ≤†ÏäµÎãàÍπå?\nÏû¨Î£åÎ°ú ÏÇ¨Ïö©Îêú ÎèôÎ¨ºÏùÄ ÏÇ¨ÎùºÏßëÎãàÎã§!`)) {
                    gameState.animals[ing1].count--;
                    gameState.animals[ing2].count--;
                    gameState.totalAnimals -= 2;

                    const resultAnimalData = animalTypes.find(a => a.name === resultName);
                    addAnimal(resultAnimalData);

                    alert(`Ìï©ÏÑ± ÏÑ±Í≥µ! Ï†ÑÏÑ§Ï†ÅÏù∏ ÎèôÎ¨º '${resultName}'ÏùÑ(Î•º) ÌöçÎìùÌñàÏäµÎãàÎã§!`);
                    
                    updateSynthesisPage();
                    updateAnimalCollection();
                    saveCurrentUserData();
                }
            } else {
                alert('Ïû¨Î£åÍ∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§!');
            }
        }


        // ==================== ÌäπÏàò Ìö®Í≥º Ìï®Ïàò ====================
        function showNewAnimalAlert(animal) {
            const alert = document.createElement('div');
            alert.className = 'new-animal-alert';
            alert.innerHTML = `
                <span class="new-animal-emoji">${animal.emoji}</span>
                <h3>ÏÉàÎ°úÏö¥ ÎèôÎ¨º Î∞úÍ≤¨! üéâ</h3>
                <p><strong>${animal.specialName}</strong> (${animal.name})ÏùÑ(Î•º) ÌöçÎìùÌñàÏäµÎãàÎã§!</p>
            `;
            document.body.appendChild(alert);
            setTimeout(() => { alert.remove(); }, 3000);
        }

        function showLevelUp() {
            const alert = document.createElement('div');
            alert.className = 'new-animal-alert';
            alert.innerHTML = `
                <span class="new-animal-emoji">‚≠ê</span>
                <h3>Î†àÎ≤® ÏóÖ! üéâ</h3>
                <p>Î†àÎ≤® ${gameState.level}Ïù¥ ÎêòÏóàÏäµÎãàÎã§!</p>
                <p>Îçî Ìù¨Í∑ÄÌïú ÎèôÎ¨ºÏùÑ ÎßåÎÇ† Ïàò ÏûàÏñ¥Ïöî!</p>
            `;
            document.body.appendChild(alert);
            setTimeout(() => { alert.remove(); }, 3000);
        }


        // ==================== ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ Î∞è Îç∞Ïù¥ÌÑ∞ Ìï®Ïàò (Firebase) ====================

        async function saveCurrentUserData() {
            if (!currentUserId || !currentUserProfile.name) return;
            
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const userDocRef = window.firebase.doc(window.firebase.db, "artifacts", appId, "users", currentUserId, "profiles", currentUserProfile.name);
            
            const dataToSave = {
                name: currentUserProfile.name,
                score: gameState.score,
                level: gameState.level,
                animals: gameState.animals,
                totalAnimals: gameState.totalAnimals,
                speciesCount: gameState.speciesCount,
                farm: gameState.farm,
                lastPlayed: new Date().toISOString()
            };

            try {
                await window.firebase.setDoc(userDocRef, dataToSave, { merge: true });
                console.log("Data saved for", currentUserProfile.name);
            } catch (error) {
                console.error("Error saving data:", error);
            }
        }

        async function loadUserData(userName) {
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const userDocRef = window.firebase.doc(window.firebase.db, "artifacts", appId, "users", currentUserId, "profiles", userName);
            const docSnap = await window.firebase.getDoc(userDocRef);

            if (docSnap.exists()) {
                return docSnap.data();
            } else {
                return null;
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'Í∏∞Î°ù ÏóÜÏùå';
            const date = new Date(dateString);
            return date.toLocaleString('ko-KR', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        }

        // ==================== ÌéòÏù¥ÏßÄ Í¥ÄÎ¶¨ Î∞è Ï¥àÍ∏∞Ìôî ====================

        window.showPage = function(pageName, element) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(pageName + '-page').classList.add('active');
            if (element) {
                element.classList.add('active');
            }
            
            const gameStats = document.getElementById('game-stats');
            const userInfo = document.getElementById('user-info');
            
            if (pageName === 'game') {
                gameStats.style.display = 'flex';
                userInfo.style.display = 'block';
            } else if (pageName === 'users') {
                gameStats.style.display = 'none';
                userInfo.style.display = 'block';
                // updateUserList(); // This is now handled by the login screen
            } else if (pageName === 'encyclopedia') {
                gameStats.style.display = 'none';
                userInfo.style.display = 'block';
                updateEncyclopedia();
            } else if (pageName === 'farm') {
                gameStats.style.display = 'flex';
                userInfo.style.display = 'block';
                initializeFarm();
            } else if (pageName === 'synthesis') {
                gameStats.style.display = 'none';
                userInfo.style.display = 'block';
                updateSynthesisPage();
            } else {
                gameStats.style.display = 'none';
                userInfo.style.display = 'none';
            }
        }
        
        // Í≤åÏûÑ Ï¥àÍ∏∞Ìôî Ìï®Ïàò (Firebase ÏÇ¨Ïö©ÏûêÎ°ú Ìò∏Ï∂úÎê®)
        window.onFirebaseReady = async (user) => {
            if (!user) {
                document.getElementById('login-feedback').textContent = "ÌÅ¥ÎùºÏö∞Îìú Ïó∞Í≤∞ Ïã§Ìå®! Ïò§ÌîÑÎùºÏù∏ Î™®ÎìúÎ°ú Ïã§ÌñâÌï©ÎãàÎã§.";
                // ÎπÑÏÉÅ Ïò§ÌîÑÎùºÏù∏ Î™®Îìú
                return;
            }
            currentUserId = user.uid;
            document.getElementById('login-overlay').style.display = 'flex';
        }

        // ==================== Î°úÍ∑∏Ïù∏/ÌöåÏõêÍ∞ÄÏûÖ Î°úÏßÅ ====================
        
        async function hashPin(pin, salt) {
            const encoder = new TextEncoder();
            const data = encoder.encode(pin + salt);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function handleSignup() {
            const nameInput = document.getElementById('player-name-input');
            const pinInput = document.getElementById('player-pin-input');
            const feedback = document.getElementById('login-feedback');
            const name = nameInput.value.trim();
            const pin = pinInput.value;

            if (!name || !pin) {
                feedback.textContent = "Ïù¥Î¶ÑÍ≥º PINÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.";
                return;
            }
            if (!/^\d{4}$/.test(pin)) {
                feedback.textContent = "PINÏùÄ 4ÏûêÎ¶¨ Ïà´ÏûêÏó¨Ïïº Ìï©ÎãàÎã§.";
                return;
            }

            feedback.textContent = "ÌôïÏù∏ Ï§ë...";
            const existingProfile = await loadUserData(name);
            if (existingProfile) {
                feedback.textContent = "Ïù¥ÎØ∏ ÏÇ¨Ïö© Ï§ëÏù∏ Ïù¥Î¶ÑÏûÖÎãàÎã§.";
                return;
            }

            const hashedPin = await hashPin(pin, name);
            const newProfile = {
                name: name,
                pinHash: hashedPin,
                score: 0,
                level: 1,
                animals: {},
                totalAnimals: 0,
                speciesCount: 0,
                farm: { layout: Array(48).fill(null), items: {} },
                createdAt: new Date().toISOString(),
                lastPlayed: new Date().toISOString()
            };

            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const userDocRef = window.firebase.doc(window.firebase.db, "artifacts", appId, "users", currentUserId, "profiles", name);
            await window.firebase.setDoc(userDocRef, newProfile);

            alert(`üéâ ${name} ÌîåÎ†àÏù¥Ïñ¥ ÏÉùÏÑ± ÏôÑÎ£å!`);
            startGameWithProfile(newProfile);
        }

        async function handleLogin() {
            const nameInput = document.getElementById('player-name-input');
            const pinInput = document.getElementById('player-pin-input');
            const feedback = document.getElementById('login-feedback');
            const name = nameInput.value.trim();
            const pin = pinInput.value;

            if (!name || !pin) {
                feedback.textContent = "Ïù¥Î¶ÑÍ≥º PINÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.";
                return;
            }

            feedback.textContent = "Î°úÍ∑∏Ïù∏ Ï§ë...";
            const profileData = await loadUserData(name);

            if (!profileData) {
                feedback.textContent = "Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî ÌîåÎ†àÏù¥Ïñ¥ÏûÖÎãàÎã§.";
                return;
            }

            const hashedPin = await hashPin(pin, name);
            if (hashedPin === profileData.pinHash) {
                startGameWithProfile(profileData);
            } else {
                feedback.textContent = "PINÏù¥ ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§.";
            }
        }

        function startGameWithProfile(profileData) {
            currentUserProfile = profileData;
            gameState = {
                score: profileData.score || 0,
                level: profileData.level || 1,
                animals: profileData.animals || {},
                totalAnimals: profileData.totalAnimals || 0,
                speciesCount: profileData.speciesCount || 0,
                farm: profileData.farm || { layout: Array(48).fill(null), items: {} },
                currentQuestion: {}
            };

            document.getElementById('login-overlay').style.display = 'none';
            document.querySelector('.game-container').style.display = 'block';
            document.getElementById('current-user-name').textContent = currentUserProfile.name;
            
            updateUI();
            updateAnimalCollection();
            generateEnglishQuiz();
            initializeFarm();
            showPage('game', document.querySelector('.nav-btn'));
        }

        function logout() {
            saveCurrentUserData(); // Î°úÍ∑∏ÏïÑÏõÉ Ï†Ñ ÌòÑÏû¨ ÏÉÅÌÉú Ï†ÄÏû•
            currentUserProfile = {};
            gameState = {};
            currentUserId = window.firebase.auth.currentUser.uid; // auth uidÎäî Ïú†ÏßÄ
            document.getElementById('login-overlay').style.display = 'flex';
            document.querySelector('.game-container').style.display = 'none';
        }

        // ==================== Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ====================
        
        document.getElementById('login-btn').addEventListener('click', handleLogin);
        document.getElementById('signup-btn').addEventListener('click', handleSignup);
        document.getElementById('player-pin-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleLogin();
        });
        
        document.getElementById('math-answer-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('math-submit-btn').click();
            }
        });

        window.addEventListener('beforeunload', function() {
            saveCurrentUserData();
        });
        
        document.getElementById('farm-grid').addEventListener('contextmenu', e => e.preventDefault());

        console.log('üêæ ÎèôÎ¨º ÏàòÏßë ÌïôÏäµ Í≤åÏûÑÏù¥ Î°úÎìúÎêòÏóàÏäµÎãàÎã§! (v5.0 - Firebase Login)');
    </script>
</body>
</html>
