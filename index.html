<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¾ ë™ë¬¼ ìˆ˜ì§‘ ìˆ˜í•™ ê²Œì„ ğŸ¾</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 50%, #FFB6C1 100%);
            min-height: 100vh;
            color: #333;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .header h1 {
            color: #2C5530;
            font-size: 2.8rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: linear-gradient(45deg, #4169E1, #1E90FF);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .nav-btn.active {
            background: linear-gradient(45deg, #32CD32, #228B22);
        }

        .user-info {
            margin: 15px 0;
        }

        .current-user {
            background: linear-gradient(45deg, #FF69B4, #FFB6C1);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .game-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            color: #8B4513;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            min-width: 120px;
            text-align: center;
        }

        /* í˜ì´ì§€ ì‹œìŠ¤í…œ */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* ê²Œì„ í˜ì´ì§€ */
        .game-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .math-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            text-align: center;
        }

        .math-section h2 {
            color: #2C5530;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .difficulty-badge {
            background: linear-gradient(45deg, #9370DB, #8A2BE2);
            color: white;
            padding: 8px 16px;
            border-radius: 15px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 20px;
        }

        .question {
            font-size: 2.5rem;
            color: #4169E1;
            margin: 25px 0;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .answer-input {
            font-size: 1.8rem;
            padding: 15px 20px;
            border: 3px solid #87CEEB;
            border-radius: 20px;
            width: 250px;
            margin: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: #4169E1;
            box-shadow: 0 0 20px rgba(65, 105, 225, 0.4);
        }

        .submit-btn {
            background: linear-gradient(45deg, #32CD32, #228B22);
            color: white;
            border: none;
            padding: 18px 35px;
            font-size: 1.3rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 15px;
            font-weight: bold;
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .feedback {
            margin: 20px 0;
            padding: 20px;
            border-radius: 20px;
            font-weight: bold;
            text-align: center;
            font-size: 1.2rem;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.5s ease;
        }

        .feedback.correct {
            background: linear-gradient(45deg, #90EE90, #32CD32);
            color: #006400;
        }

        .feedback.incorrect {
            background: linear-gradient(45deg, #FFB6C1, #FF69B4);
            color: #8B0000;
        }

        /* ë™ë¬¼ ì»¬ë ‰ì…˜ */
        .collection-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .collection-section h2 {
            color: #2C5530;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8rem;
        }

        .collection-hint {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-style: italic;
        }

        .animal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            max-height: 450px;
            overflow-y: auto;
            padding: 5px;
        }

        .animal-card {
            background: linear-gradient(45deg, #FFE4E1, #F0E68C);
            border-radius: 20px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 3px solid transparent;
        }

        .animal-card:hover {
            transform: scale(1.08);
            box-shadow: 0 12px 35px rgba(0,0,0,0.25);
        }

        .animal-emoji {
            font-size: 3.5rem;
            display: block;
            margin-bottom: 10px;
        }

        .animal-name {
            font-weight: bold;
            color: #2C5530;
            margin-bottom: 5px;
            font-size: 1rem;
            word-break: keep-all;
        }
        
        .animal-level {
            font-weight: bold;
            font-size: 1.1rem;
            color: #8A2BE2;
            margin-bottom: 8px;
        }

        .special-name {
            color: #8B4513;
            font-style: italic;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .rarity-badge {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #8B4513;
            font-size: 0.8rem;
            font-weight: bold;
            padding: 4px 10px;
            border-radius: 12px;
            display: inline-block;
        }

        /* í€´ì¦ˆ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1001; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #E0F7FA, #FFFFFF, #FFF9C4);
            margin: auto;
            padding: 30px;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
            position: relative;
        }

        .close-btn {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: black;
        }
        
        #quiz-question {
            font-size: 1.5rem;
            color: #2C5530;
            margin-bottom: 25px;
        }

        .quiz-options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .quiz-option-btn {
            background: linear-gradient(45deg, #89CFF0, #4682B4);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quiz-option-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* ì‚¬ìš©ì ê´€ë¦¬ í˜ì´ì§€ */
        .user-management { background: rgba(255, 255, 255, 0.95); padding: 35px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); max-width: 900px; margin: 0 auto; }
        .user-management h2 { color: #2C5530; margin-bottom: 25px; text-align: center; font-size: 2rem; }
        .user-form { background: linear-gradient(45deg, #E6F3FF, #F0E6FF); padding: 25px; border-radius: 20px; margin-bottom: 25px; }
        .user-form h3 { color: #4169E1; margin-bottom: 15px; font-size: 1.3rem; }
        .user-input { width: 280px; padding: 15px; font-size: 1.1rem; border: 2px solid #87CEEB; border-radius: 15px; margin: 0 15px 15px 0; }
        .user-btn { background: linear-gradient(45deg, #32CD32, #228B22); color: white; border: none; padding: 15px 25px; font-size: 1rem; border-radius: 15px; cursor: pointer; margin: 5px; font-weight: bold; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .user-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        .user-btn.danger { background: linear-gradient(45deg, #FF6B6B, #FF4757); }
        .user-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 25px; }
        .user-card { background: linear-gradient(45deg, #FFE4E1, #F0E68C); padding: 20px; border-radius: 20px; text-align: center; box-shadow: 0 6px 20px rgba(0,0,0,0.15); transition: all 0.3s ease; cursor: pointer; border: 3px solid transparent; }
        .user-card:hover { transform: scale(1.05); box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
        .user-card.active { border: 3px solid #32CD32; background: linear-gradient(45deg, #90EE90, #98FB98); }
        .user-card h4 { color: #2C5530; margin-bottom: 12px; font-size: 1.2rem; }
        .user-stats { font-size: 0.95rem; color: #666; line-height: 1.4; }

        /* ì‚¬ìš©ì„¤ëª…ì„œ í˜ì´ì§€ */
        .instructions { background: rgba(255, 255, 255, 0.95); padding: 40px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); max-width: 900px; margin: 0 auto; }
        .instructions h2 { color: #2C5530; font-size: 2.2rem; margin-bottom: 25px; text-align: center; }
        .instructions h3 { color: #4169E1; font-size: 1.4rem; margin: 25px 0 15px 0; }
        .instructions p, .instructions li { font-size: 1.1rem; line-height: 1.7; color: #333; margin-bottom: 12px; }
        .instructions ul { margin-left: 25px; margin-bottom: 18px; }
        
        /* ë™ë¬¼ ë„ê° ìŠ¤íƒ€ì¼ */
        .encyclopedia-container { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .encyclopedia-container h2 { color: #2C5530; text-align: center; font-size: 2rem; margin-bottom: 20px; }
        .encyclopedia-progress { text-align: center; font-size: 1.2rem; font-weight: bold; color: #4169E1; margin-bottom: 20px; }
        .progress-bar-container { width: 80%; max-width: 500px; height: 25px; background-color: #e0e0e0; border-radius: 15px; margin: 10px auto; overflow: hidden; }
        .progress-bar-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #98FB98, #32CD32); border-radius: 15px; transition: width 0.5s ease-in-out; }
        .encyclopedia-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; max-height: 60vh; overflow-y: auto; padding: 10px; }
        .encyclopedia-card { background: #fff; border-radius: 15px; padding: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: all 0.3s ease; }
        .encyclopedia-card.uncollected { filter: grayscale(100%); opacity: 0.6; }
        .encyclopedia-card .animal-emoji { font-size: 3rem; }
        .encyclopedia-card .animal-name { font-size: 1rem; }
        .encyclopedia-card .animal-count { font-size: 0.9rem; color: #666; }

        /* ë†ì¥ ê¾¸ë¯¸ê¸° ìŠ¤íƒ€ì¼ */
        .farm-page-container { display: grid; grid-template-columns: 300px 1fr; gap: 20px; }
        .farm-controls { background: rgba(255, 255, 255, 0.95); padding: 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .farm-controls h3 { color: #2C5530; text-align: center; margin-bottom: 15px; }
        .shop-grid, .inventory-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-height: 250px; overflow-y: auto; padding: 5px; }
        .shop-item, .inventory-item { background: #f0f8ff; border-radius: 15px; padding: 10px; text-align: center; cursor: pointer; transition: all 0.2s ease; border: 2px solid #87CEEB; }
        .shop-item:hover, .inventory-item:hover { transform: scale(1.05); background: #e0f0ff; }
        .inventory-item.selected { border-color: #FF69B4; background: #ffe6f0; }
        .item-emoji { font-size: 2.5rem; }
        .item-name { font-weight: bold; font-size: 0.9rem; }
        .item-price, .item-count { font-size: 0.8rem; color: #555; }
        .farm-area { background: linear-gradient(to bottom, #a8e063, #56ab2f); padding: 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .farm-grid { display: grid; grid-template-columns: repeat(8, 1fr); grid-template-rows: repeat(6, 1fr); gap: 5px; aspect-ratio: 8 / 6; }
        .farm-cell { background: rgba(255, 255, 255, 0.2); border-radius: 10px; cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; position: relative; }
        .farm-cell:hover { background: rgba(255, 255, 255, 0.4); }
        .farm-cell .placed-animal { position: absolute; bottom: 5px; opacity: 0.9; animation: bounce 2s infinite ease-in-out; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        /* íŠ¹ìˆ˜ íš¨ê³¼ */
        .new-animal-alert { z-index: 1000; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(45deg, #FFD700, #FFA500); padding: 35px; border-radius: 25px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.4); animation: popIn 0.6s ease; }
        .new-animal-alert .new-animal-emoji { font-size: 6rem; display: block; margin-bottom: 20px; }
        .new-animal-alert h3 { color: #8B4513; margin-bottom: 15px; font-size: 1.5rem; }
        .new-animal-alert p { color: #8B4513; font-weight: bold; margin-bottom: 10px; }
        @keyframes popIn { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 900px) {
            .game-content, .farm-page-container { grid-template-columns: 1fr; }
            .farm-controls { margin-bottom: 20px; }
        }
        @media (max-width: 768px) {
            .game-container { padding: 15px; }
            .header h1 { font-size: 2.2rem; }
            .game-stats { flex-direction: column; align-items: center; gap: 10px; }
            .nav-buttons { flex-direction: column; align-items: center; gap: 10px; }
            .question { font-size: 2rem; }
            .answer-input { width: 200px; font-size: 1.5rem; }
            .animal-grid { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; }
            .user-list { grid-template-columns: 1fr; }
            .quiz-options-grid { grid-template-columns: 1fr; }
            .encyclopedia-grid { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>ğŸ¾ ë™ë¬¼ ìˆ˜ì§‘ ìˆ˜í•™ ê²Œì„ ğŸ¾</h1>
            
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showPage('game', this)">ê²Œì„í•˜ê¸° ğŸ®</button>
                <button class="nav-btn" onclick="showPage('farm', this)">ë†ì¥ ê¾¸ë¯¸ê¸° ğŸ¡</button>
                <button class="nav-btn" onclick="showPage('encyclopedia', this)">ë™ë¬¼ ë„ê° ğŸ“š</button>
                <button class="nav-btn" onclick="showPage('instructions', this)">ì‚¬ìš©ì„¤ëª…ì„œ ğŸ“–</button>
                <button class="nav-btn" onclick="showPage('users', this)">ì‚¬ìš©ì ê´€ë¦¬ ğŸ‘¥</button>
            </div>

            <div class="user-info" id="user-info">
                <div class="current-user">í˜„ì¬ í”Œë ˆì´ì–´: <span id="current-user-name">ê²ŒìŠ¤íŠ¸</span></div>
            </div>

            <div class="game-stats" id="game-stats">
                <div class="stat-item">ë ˆë²¨ <span id="level">1</span></div>
                <div class="stat-item">ì ìˆ˜: <span id="score">0</span></div>
                <div class="stat-item">ë™ë¬¼ ì¢…ë¥˜: <span id="species-count">0</span>ì¢…</div>
                <div class="stat-item">ì´ ë™ë¬¼: <span id="total-animals">0</span>ë§ˆë¦¬</div>
            </div>
        </div>

        <!-- ê²Œì„ í˜ì´ì§€ -->
        <div id="game-page" class="page active">
            <div class="game-content">
                <div class="math-section">
                    <h2>ğŸ§® ìˆ˜í•™ ë¬¸ì œ</h2>
                    <div class="difficulty-badge">í˜„ì¬ ë‚œì´ë„: <span id="difficulty">ì‰¬ì›€</span></div>
                    <div class="question" id="question">5 + 3 = ?</div>
                    <input type="number" class="answer-input" id="answer" placeholder="ë‹µì„ ì…ë ¥í•˜ì„¸ìš”">
                    <br>
                    <button class="submit-btn" onclick="checkAnswer()">ë‹µ í™•ì¸í•˜ê¸°! ğŸ¯</button>
                    <div class="feedback" id="feedback"></div>
                </div>

                <div class="collection-section">
                    <h2>ğŸ  ë‚´ ë™ë¬¼ ì»¬ë ‰ì…˜</h2>
                    <p class="collection-hint">ğŸ’¡ ë™ë¬¼ì„ í´ë¦­í•´ì„œ ì˜ì–´ í€´ì¦ˆë¡œ ë ˆë²¨ì—… ì‹œì¼œìš”!</p>
                    <div class="animal-grid" id="animal-collection"></div>
                </div>
            </div>
        </div>
        
        <!-- ë†ì¥ ê¾¸ë¯¸ê¸° í˜ì´ì§€ -->
        <div id="farm-page" class="page">
            <div class="farm-page-container">
                <div class="farm-controls">
                    <h3>ğŸŒ³ ìƒì  ğŸ’°</h3>
                    <div class="shop-grid" id="shop-grid"></div>
                    <hr style="margin: 20px 0;">
                    <h3>ğŸ’ ë³´ê´€í•¨</h3>
                    <div class="inventory-grid" id="inventory-grid"></div>
                </div>
                <div class="farm-area">
                    <div class="farm-grid" id="farm-grid"></div>
                </div>
            </div>
        </div>
        
        <!-- ë™ë¬¼ ë„ê° í˜ì´ì§€ -->
        <div id="encyclopedia-page" class="page">
            <div class="encyclopedia-container">
                <h2>ğŸ“š ë™ë¬¼ ë„ê°</h2>
                <div class="encyclopedia-progress">
                    ìˆ˜ì§‘ë¥ : <span id="collection-progress">0 / 105</span> ì¢…
                    <div class="progress-bar-container">
                        <div id="progress-bar" class="progress-bar-fill"></div>
                    </div>
                </div>
                <div class="encyclopedia-grid" id="encyclopedia-grid"></div>
            </div>
        </div>

        <!-- ì‚¬ìš©ì„¤ëª…ì„œ í˜ì´ì§€ -->
        <div id="instructions-page" class="page">
            <div class="instructions">
                <h2>ğŸ“– ê²Œì„ ì‚¬ìš©ì„¤ëª…ì„œ</h2>
                
                <h3>ğŸ¡ ë†ì¥ ê¾¸ë¯¸ê¸° ì‹œìŠ¤í…œ (ì‹ ê·œ)</h3>
                <p>ìˆ˜í•™ ë¬¸ì œë¥¼ í’€ì–´ ì–»ì€ ì ìˆ˜ë¡œ ìƒì ì—ì„œ ë‚˜ë¬´, ê½ƒ ë“± ë‹¤ì–‘í•œ ì•„ì´í…œì„ êµ¬ë§¤í•˜ì„¸ìš”. êµ¬ë§¤í•œ ì•„ì´í…œì€ ë³´ê´€í•¨ì— ì €ì¥ë˜ë©°, ë³´ê´€í•¨ì—ì„œ ì•„ì´í…œì„ ì„ íƒí•œ í›„ ë†ì¥ì˜ ì›í•˜ëŠ” ìœ„ì¹˜ë¥¼ í´ë¦­í•˜ì—¬ ë°°ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‚˜ë§Œì˜ ë©‹ì§„ ë™ë¬¼ ë†ì¥ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>

                <h3>ğŸ“š ë™ë¬¼ ë„ê° ì‹œìŠ¤í…œ</h3>
                <p>'ë™ë¬¼ ë„ê°' í˜ì´ì§€ì—ì„œ ì „ì²´ ë™ë¬¼ ëª©ë¡ê³¼ ë‚˜ì˜ ìˆ˜ì§‘ í˜„í™©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ì§ ì¡ì§€ ëª»í•œ ë™ë¬¼ì€ ì‹¤ë£¨ì—£ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
        </div>

        <!-- ì‚¬ìš©ì ê´€ë¦¬ í˜ì´ì§€ -->
        <div id="users-page" class="page">
            <div class="user-management">
                <h2>ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬</h2>
                <div class="user-form">
                    <h3>ğŸ†• ìƒˆ ì‚¬ìš©ì ë§Œë“¤ê¸°</h3>
                    <input type="text" id="new-user-name" class="user-input" placeholder="ì‚¬ìš©ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="20">
                    <button class="user-btn" onclick="createUser()">ì‚¬ìš©ì ìƒì„± âœ¨</button>
                </div>
                <div class="user-form">
                    <h3>ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3>
                    <button class="user-btn" onclick="exportGameData()">ë°ì´í„° ë‚´ë³´ë‚´ê¸° ğŸ“¤</button>
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importGameData(event)">
                    <button class="user-btn" onclick="document.getElementById('import-file').click()">ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ğŸ“¥</button>
                    <button class="user-btn danger" onclick="resetAllData()">ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™” ğŸ—‘ï¸</button>
                </div>
                <h3>ğŸ† ì‚¬ìš©ì ëª©ë¡ ë° ìˆœìœ„</h3>
                <div class="user-list" id="user-list"></div>
            </div>
        </div>
    </div>
    
    <!-- í€´ì¦ˆ ëª¨ë‹¬ HTML -->
    <div id="quiz-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeQuizModal()">&times;</span>
            <h3 id="quiz-question">í€´ì¦ˆ ì§ˆë¬¸ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</h3>
            <div id="quiz-options" class="quiz-options-grid"></div>
        </div>
    </div>


    <script>
        // ==================== ê²Œì„ ë°ì´í„° ====================
        
        let gameState = {
            score: 0,
            level: 1,
            currentQuestion: {},
            animals: {},
            totalAnimals: 0,
            speciesCount: 0,
            farm: {
                layout: Array(48).fill(null),
                items: {}
            }
        };

        let currentUser = 'ê²ŒìŠ¤íŠ¸';
        let allUsers = {};
        let selectedItemToPlace = null;

        const animalTypes = [
            {emoji: 'ğŸ¶', name: 'ê°•ì•„ì§€', specialName: 'ë©ë©ì™•ì', rarity: 1}, {emoji: 'ğŸ±', name: 'ê³ ì–‘ì´', specialName: 'ì•¼ì˜¹ê³µì£¼', rarity: 1}, {emoji: 'ğŸ°', name: 'í† ë¼', specialName: 'ê¹¡ì´ëŒ€ì¥', rarity: 1}, {emoji: 'ğŸ·', name: 'ë¼ì§€', specialName: 'ê¿€ê¿€ëŒ€ë§ˆì™•', rarity: 1}, {emoji: 'ğŸ®', name: 'ì†Œ', specialName: 'ìŒë©”ìš”ì •', rarity: 1}, {emoji: 'ğŸ”', name: 'ë‹­', specialName: 'ê¼¬ê¼¬ëŒ ì‚¬ë ¹ê´€', rarity: 1}, {emoji: 'ğŸ¸', name: 'ê°œêµ¬ë¦¬', specialName: 'ê°œê³¨ë°•ì‚¬', rarity: 1}, {emoji: 'ğŸ¦†', name: 'ì˜¤ë¦¬', specialName: 'ê½¥ê½¥ì„ ì¥', rarity: 1}, {emoji: 'ğŸ­', name: 'ì¥', specialName: 'ì¹˜ì¦ˆ íƒí—˜ê°€', rarity: 1}, {emoji: 'ğŸ¹', name: 'í–„ìŠ¤í„°', specialName: 'í•´ë°”ë¼ê¸°ì”¨ ë¶€ì', rarity: 1}, {emoji: 'ğŸ‘', name: 'ì–‘', specialName: 'ë­‰ê²Œêµ¬ë¦„', rarity: 1}, {emoji: 'ğŸ¦‹', name: 'ë‚˜ë¹„', specialName: 'ë¬´ì§€ê°œë‚ ê°œ', rarity: 1}, {emoji: 'ğŸ', name: 'ë²Œ', specialName: 'ê¿€ë²Œê¸°ì‚¬', rarity: 1}, {emoji: 'ğŸ', name: 'ë¬´ë‹¹ë²Œë ˆ', specialName: 'í–‰ìš´ì˜ ìš”ì •', rarity: 1}, {emoji: 'ğŸŒ', name: 'ë‹¬íŒ½ì´', specialName: 'ëŠë¦¼ì˜ ë¯¸í•™', rarity: 1}, {emoji: 'ğŸŸ', name: 'ë¬¼ê³ ê¸°', specialName: 'ë°”ë‹¤ì˜ ì—¬í–‰ì', rarity: 1}, {emoji: 'ğŸ¦€', name: 'ê²Œ', specialName: 'ì˜†ê±¸ìŒì˜ ë‹¬ì¸', rarity: 1}, {emoji: 'ğŸ¿ï¸', name: 'ë‹¤ëŒì¥', specialName: 'ë„í† ë¦¬ ìˆ˜ì§‘ê°€', rarity: 1}, {emoji: 'ğŸ¦', name: 'ìƒˆ', specialName: 'í•˜ëŠ˜ì˜ í¸ì§€', rarity: 1}, {emoji: 'ğŸ›', name: 'ì• ë²Œë ˆ', specialName: 'ë³€ì‹ ì˜ ê·€ì¬', rarity: 1}, {emoji: 'ğŸœ', name: 'ê°œë¯¸', specialName: 'ì‘ì€ ê±´ì¶•ê°€', rarity: 1}, {emoji: 'ğŸ¢', name: 'ê±°ë¶ì´', specialName: 'ì‹œê°„ ì—¬í–‰ì', rarity: 1}, {emoji: 'ğŸ', name: 'ì—¼ì†Œ', specialName: 'ì¢…ì´ ë¯¸ì‹ê°€', rarity: 1}, {emoji: 'ğŸ´', name: 'ë§', specialName: 'ì´ˆì›ì˜ ë°”ëŒ', rarity: 1}, {emoji: 'ğŸ ', name: 'ì—´ëŒ€ì–´', specialName: 'ì‚°í˜¸ì´ˆì˜ ë³´ì„', rarity: 1},
            {emoji: 'ğŸ¦Š', name: 'ì—¬ìš°', specialName: 'ìˆ²ì†ì˜ ì‹ ì‚¬', rarity: 2}, {emoji: 'ğŸ»', name: 'ê³°', specialName: 'ê¿€ë‹¨ì§€ íŒŒìˆ˜ê¾¼', rarity: 2}, {emoji: 'ğŸ¦', name: 'ë„ˆêµ¬ë¦¬', specialName: 'ì†œì‚¬íƒ• ì‚¬ëƒ¥ê¾¼', rarity: 2}, {emoji: 'ğŸ¦Œ', name: 'ì‚¬ìŠ´', specialName: 'ìˆ²ì˜ ì™•ì', rarity: 2}, {emoji: 'ğŸ¦‰', name: 'ì˜¬ë¹¼ë¯¸', specialName: 'ì§€í˜œë¡œìš´ ì', rarity: 2}, {emoji: 'ğŸº', name: 'ëŠ‘ëŒ€', specialName: 'ë‹¬ë¹›ì‚¬ëƒ¥ê¾¼', rarity: 2}, {emoji: 'ğŸ¦‡', name: 'ë°•ì¥', specialName: 'ë°¤ì˜ ë¹„í–‰ì‚¬', rarity: 2}, {emoji: 'ğŸ', name: 'ë±€', specialName: 'ë¹„ë°€ì˜ ìˆ˜í˜¸ì', rarity: 2}, {emoji: 'ğŸ¦…', name: 'ë…ìˆ˜ë¦¬', specialName: 'í•˜ëŠ˜ì˜ ì œì™•', rarity: 2}, {emoji: 'ğŸ§', name: 'í­ê·„', specialName: 'ì–¼ìŒ ì‹ ì‚¬', rarity: 2}, {emoji: 'ğŸ¨', name: 'ì½”ì•Œë¼', specialName: 'ìœ ì¹¼ë¦½íˆ¬ìŠ¤ ìš”ì •', rarity: 2}, {emoji: 'ğŸ’', name: 'ì›ìˆ­ì´', specialName: 'ì¥ë‚œê¾¸ëŸ¬ê¸° ëŒ€ì¥', rarity: 2}, {emoji: 'ğŸ—', name: 'ë©§ë¼ì§€', specialName: 'ëŒê²©ëŒ€ì¥', rarity: 2}, {emoji: 'ğŸ¦¦', name: 'ìˆ˜ë‹¬', specialName: 'ì¡°ì•½ëŒ ì•„í‹°ìŠ¤íŠ¸', rarity: 2}, {emoji: 'ğŸ¦¢', name: 'ë°±ì¡°', specialName: 'í˜¸ìˆ˜ì˜ ì—¬ì™•', rarity: 2}, {emoji: 'ğŸ¦”', name: 'ê³ ìŠ´ë„ì¹˜', specialName: 'ë°¤ì†¡ì´ ê¸°ì‚¬', rarity: 2}, {emoji: 'ğŸ¦', name: 'ë„ë§ˆë±€', specialName: 'í–‡ì‚´ ì‚¬ëƒ¥ê¾¼', rarity: 2}, {emoji: 'ğŸ™', name: 'ë¬¸ì–´', specialName: 'ì´‰ìˆ˜ë§ˆë²•ì‚¬', rarity: 2}, {emoji: 'ğŸ¦', name: 'ìƒˆìš°', specialName: 'ë°”ë‹¤ì˜ ëŒ„ì„œ', rarity: 2}, {emoji: 'ğŸ¦‘', name: 'ì˜¤ì§•ì–´', specialName: 'ë¨¹ë¬¼ ì˜ˆìˆ ê°€', rarity: 2}, {emoji: 'ğŸ¦˜', name: 'ìº¥ê±°ë£¨', specialName: 'ìŠ¤í…ì˜ ì±”í”¼ì–¸', rarity: 2}, {emoji: 'ğŸ•Šï¸', name: 'ë¹„ë‘˜ê¸°', specialName: 'í‰í™”ì˜ ì‚¬ë„', rarity: 2}, {emoji: 'ğŸ¦œ', name: 'ì•µë¬´ìƒˆ', specialName: 'ë§í•˜ëŠ” ë³´ì„', rarity: 2}, {emoji: 'ğŸ«', name: 'ë‚™íƒ€', specialName: 'ì‚¬ë§‰ì˜ ìƒì¸', rarity: 2}, {emoji: 'ğŸ¦™', name: 'ë¼ë§ˆ', specialName: 'ì•ˆë°ìŠ¤ì˜ ì‹ ì‚¬', rarity: 2},
            {emoji: 'ğŸ˜', name: 'ì½”ë¼ë¦¬', specialName: 'ê¸°ì–µì˜ í˜„ì', rarity: 3}, {emoji: 'ğŸ¦’', name: 'ê¸°ë¦°', specialName: 'êµ¬ë¦„ ì‚°ì±…ê°€', rarity: 3}, {emoji: 'ğŸ¦“', name: 'ì–¼ë£©ë§', specialName: 'ì´ˆì›ì˜ ìˆ˜ìˆ˜ê»˜ë¼', rarity: 3}, {emoji: 'ğŸ¼', name: 'íŒë‹¤', specialName: 'ëŒ€ë‚˜ë¬´ ë¯¸ì‹ê°€', rarity: 3}, {emoji: 'ğŸ¦›', name: 'í•˜ë§ˆ', specialName: 'ê°•ì˜ êµ°ì£¼', rarity: 3}, {emoji: 'ğŸ¦', name: 'ì½”ë¿”ì†Œ', specialName: 'ê°•ì² ì˜ ëŒê²©ìˆ˜', rarity: 3}, {emoji: 'ğŸŠ', name: 'ì•…ì–´', specialName: 'ëŠªì˜ í¬ì‹ì', rarity: 3}, {emoji: 'ğŸ…', name: 'í˜¸ë‘ì´', specialName: 'ë°€ë¦¼ì˜ êµ°ì£¼', rarity: 3}, {emoji: 'ğŸ†', name: 'í‘œë²”', specialName: 'ê·¸ë¦¼ì ì•”ì‚´ì', rarity: 3}, {emoji: 'ğŸ¦', name: 'ê³ ë¦´ë¼', specialName: 'ìˆ²ì˜ ìˆ˜í˜¸ì‹ ', rarity: 3}, {emoji: 'ğŸ¬', name: 'ëŒê³ ë˜', specialName: 'íŒŒë„ì˜ ì¹œêµ¬', rarity: 3}, {emoji: 'ï¿½', name: 'ê³ ë˜', specialName: 'ì‹¬í•´ì˜ ë…¸ë˜', rarity: 3}, {emoji: 'ğŸ¦ˆ', name: 'ìƒì–´', specialName: 'ë°”ë‹¤ì˜ ì¶”ê²©ì', rarity: 3}, {emoji: 'ğŸ¦š', name: 'ê³µì‘', specialName: 'ë³„ë¹› ê¹ƒí„¸', rarity: 3}, {emoji: 'ğŸ¦‚', name: 'ì „ê°ˆ', specialName: 'ì‚¬ë§‰ì˜ ë…ì¹¨', rarity: 3}, {emoji: 'ğŸ¦¥', name: 'ë‚˜ë¬´ëŠ˜ë³´', specialName: 'ëŠê¸‹í•œ ì² í•™ì', rarity: 3}, {emoji: 'ğŸƒ', name: 'ë¬¼ì†Œ', specialName: 'ì§„í™ì˜ ì™•', rarity: 3}, {emoji: 'ğŸ¦', name: 'ë°”ë‹·ê°€ì¬', specialName: 'ì‹¬í•´ì˜ ê¸°ì‚¬', rarity: 3}, {emoji: 'ğŸ¡', name: 'ë³µì–´', specialName: 'ê°€ì‹œ ë°©íŒ¨', rarity: 3}, {emoji: 'ğŸ¦¡', name: 'ì˜¤ì†Œë¦¬', specialName: 'ë•…êµ´ì˜ ì œì™•', rarity: 3},
            {emoji: 'ğŸ¦', name: 'ì‚¬ì', specialName: 'í™©ê¸ˆê°ˆê¸°ì™•', rarity: 4}, {emoji: 'ğŸ»â€â„ï¸', name: 'ë¶ê·¹ê³°', specialName: 'ì„¤ì›ì˜ ì§€ë°°ì', rarity: 4}, {emoji: 'ğŸ¦£', name: 'ë§¤ë¨¸ë“œ', specialName: 'ë¹™í•˜ê¸°ì˜ ê±°ì¸', rarity: 4}, {emoji: 'ğŸ¦–', name: 'í‹°ë¼ë…¸ì‚¬ìš°ë£¨ìŠ¤', specialName: 'í­êµ° ë„ë§ˆë±€', rarity: 4}, {emoji: 'ğŸ‰', name: 'ìš©', specialName: 'ì „ì„¤ì˜ ë“œë˜ê³¤', rarity: 4}, {emoji: 'ğŸ³', name: 'ëŒ€ì™•ê³ ë˜', specialName: 'ëŒ€ì–‘ì˜ ì‹¬ì¥', rarity: 4}, {emoji: 'ğŸ¦‘', name: 'ëŒ€ì™•ì˜¤ì§•ì–´', specialName: 'í¬ë¼ì¼„ì˜ í›„ì˜ˆ', rarity: 4}, {emoji: 'ğŸ¦…', name: 'í•˜í”¼', specialName: 'ì°½ê³µì˜ ì§€ë°°ì', rarity: 4}, {emoji: 'ğŸ¦§', name: 'ì˜¤ë‘ìš°íƒ„', specialName: 'ìˆ²ì˜ í˜„ì', rarity: 4}, {emoji: 'ğŸ…', name: 'ë°±í˜¸', specialName: 'ë‹¬ì˜ ì •ê¸°', rarity: 4}, {emoji: 'ğŸˆâ€â¬›', name: 'í‘í‘œë²”', specialName: 'ë°¤ì˜ ê·¸ë¦¼ì', rarity: 4}, {emoji: 'ğŸ¦•', name: 'ë¸Œë¼í‚¤ì˜¤ì‚¬ìš°ë£¨ìŠ¤', specialName: 'ì›€ì§ì´ëŠ” ìˆ²', rarity: 4}, {emoji: 'ğŸ¦—', name: 'ì‚¬ë§ˆê·€', specialName: 'ë‹¹ë‘ê¶Œì˜ ê³ ìˆ˜', rarity: 4}, {emoji: 'ğŸ•·ï¸', name: 'ê±°ë¯¸', specialName: 'ê±°ë¯¸ì¤„ì˜ ì„¤ê³„ì', rarity: 4}, {emoji: 'ğŸ¦Š', name: 'ë¶ê·¹ì—¬ìš°', specialName: 'ì„¤ì›ì˜ ìœ ë ¹', rarity: 4},
            {emoji: 'ğŸ¦„', name: 'ìœ ë‹ˆì½˜', specialName: 'ìˆœìˆ˜ì˜ ë¿”', rarity: 5}, {emoji: 'ğŸ²', name: 'ë™ì–‘ìš©', specialName: 'ì—¬ì˜ì£¼ì˜ ì£¼ì¸', rarity: 5}, {emoji: 'ğŸ”¥', name: 'ë¶ˆì‚¬ì¡°', specialName: 'ë¶ˆë©¸ì˜ í™”ì‹ ', rarity: 5}, {emoji: 'ğŸ¦', name: 'ê·¸ë¦¬í•€', specialName: 'ì‚¬ìì™€ ë…ìˆ˜ë¦¬ì˜ ì™•', rarity: 5}, {emoji: 'ğŸ', name: 'í˜ê°€ìˆ˜ìŠ¤', specialName: 'ë‚ ê°œ ë‹¬ë¦° ì²œë§ˆ', rarity: 5}, {emoji: 'ğŸº', name: 'íœë¦¬ë¥´', specialName: 'ì‹ í™” ì† ëŠ‘ëŒ€', rarity: 5}, {emoji: 'ğŸ', name: 'íˆë“œë¼', specialName: 'ë¶ˆë©¸ì˜ ë¨¸ë¦¬', rarity: 5}, {emoji: 'ğŸ', name: 'í‚¤ë©”ë¼', specialName: 'í™˜ìƒì˜ ì¡°í•©', rarity: 5}, {emoji: 'ğŸ§œâ€â™€ï¸', name: 'ì¸ì–´', specialName: 'ë°”ë‹¤ì˜ ë…¸ë˜', rarity: 5}, {emoji: 'ğŸ‘¾', name: 'ì™¸ê³„ì¸', specialName: 'ë¯¸ì§€ì˜ ë°©ë¬¸ì', rarity: 5},
            {emoji: 'ğŸŒŸ', name: 'ë³„ì˜ ì •ë ¹', specialName: 'ìš°ì£¼ì˜ ì†ì‚­ì„', rarity: 6}, {emoji: 'â˜€ï¸', name: 'íƒœì–‘ì˜ í™”ì‹ ', specialName: 'ëª¨ë“  ë¹›ì˜ ê·¼ì›', rarity: 6}, {emoji: 'ğŸŒ™', name: 'ë‹¬ì˜ ìˆ˜í˜¸ì', specialName: 'ë°¤í•˜ëŠ˜ì˜ ëˆˆ', rarity: 6}, {emoji: 'ğŸŒ³', name: 'ì„¸ê³„ìˆ˜', specialName: 'ì‚´ì•„ìˆëŠ” ëŒ€ì§€', rarity: 6}, {emoji: 'ğŸŒŠ', name: 'ëŒ€ì–‘ì˜ í˜¼', specialName: 'ëª¨ë“  ë¬¼ì˜ ì‹œì‘', rarity: 6}, {emoji: 'ğŸŒªï¸', name: 'í­í’ì˜ ëˆˆ', specialName: 'í•˜ëŠ˜ì˜ ë¶„ë…¸', rarity: 6}, {emoji: 'ğŸ’', name: 'ë³´ì„ ê³¨ë ˜', specialName: 'ì˜ì›ì˜ ê²°ì •ì²´', rarity: 6}, {emoji: 'ğŸŒŒ', name: 'ì€í•˜ë£¡', specialName: 'ë³„ì„ ì‚¼í‚¤ëŠ” ì', rarity: 6}, {emoji: 'â³', name: 'ì‹œê°„ì˜ ëª¨ë˜ì‹œê³„', specialName: 'ê³¼ê±°ì™€ ë¯¸ë˜ì˜ ì£¼ì¸', rarity: 6}, {emoji: 'ğŸ¤–', name: 'ê¶ê·¹ì˜ ë¡œë´‡', specialName: 'ë¯¸ë˜ì˜ ì§€ë°°ì', rarity: 6}
        ];
        
        const quizWords = [
            { question: 'ì‚¬ê³¼', answer: 'apple', options: ['banana', 'orange', 'grape', 'water'] }, { question: 'ê°€ë°©', answer: 'bag', options: ['book', 'pen', 'desk', 'chair'] }, { question: 'ê³µ', answer: 'ball', options: ['doll', 'car', 'toy', 'game'] }, { question: 'ì¹¨ëŒ€', answer: 'bed', options: ['desk', 'chair', 'table', 'sofa'] }, { question: 'ìì „ê±°', answer: 'bike', options: ['car', 'bus', 'train', 'boat'] }, { question: 'ìƒˆ', answer: 'bird', options: ['dog', 'cat', 'fish', 'lion'] }, { question: 'ë³´íŠ¸', answer: 'boat', options: ['car', 'bus', 'train', 'plane'] }, { question: 'ì±…', answer: 'book', options: ['pen', 'note', 'desk', 'paper'] }, { question: 'ìƒì', answer: 'box', options: ['bag', 'desk', 'chair', 'bed'] }, { question: 'ì†Œë…„', answer: 'boy', options: ['girl', 'man', 'woman', 'baby'] }, { question: 'ë¹µ', answer: 'bread', options: ['milk', 'cheese', 'rice', 'water'] }, { question: 'ë²„ìŠ¤', answer: 'bus', options: ['car', 'train', 'bike', 'taxi'] }, { question: 'ìë™ì°¨', answer: 'car', options: ['bus', 'train', 'bike', 'plane'] }, { question: 'ê³ ì–‘ì´', answer: 'cat', options: ['dog', 'bird', 'fish', 'hamster'] }, { question: 'ì˜ì', answer: 'chair', options: ['desk', 'table', 'bed', 'sofa'] }, { question: 'ë„ì‹œ', answer: 'city', options: ['town', 'country', 'village', 'island'] }, { question: 'ì‹œê³„', answer: 'clock', options: ['watch', 'timer', 'calendar', 'time'] }, { question: 'êµ¬ë¦„', answer: 'cloud', options: ['sun', 'moon', 'star', 'sky'] }, { question: 'ì»´í“¨í„°', answer: 'computer', options: ['tv', 'phone', 'radio', 'camera'] }, { question: 'ì†Œ', answer: 'cow', options: ['pig', 'sheep', 'horse', 'goat'] }, { question: 'ì»µ', answer: 'cup', options: ['glass', 'bowl', 'plate', 'bottle'] }, { question: 'ë‚®', answer: 'day', options: ['night', 'morning', 'evening', 'time'] }, { question: 'ì±…ìƒ', answer: 'desk', options: ['chair', 'table', 'bed', 'sofa'] }, { question: 'ê°œ', answer: 'dog', options: ['cat', 'bird', 'fish', 'rabbit'] }, { question: 'ì¸í˜•', answer: 'doll', options: ['ball', 'toy', 'game', 'robot'] }, { question: 'ë¬¸', answer: 'door', options: ['window', 'wall', 'floor', 'roof'] }, { question: 'ì˜¤ë¦¬', answer: 'duck', options: ['chicken', 'bird', 'goose', 'swan'] }, { question: 'ê³„ë€', answer: 'egg', options: ['milk', 'bread', 'cheese', 'meat'] }, { question: 'ëˆˆ', answer: 'eye', options: ['nose', 'mouth', 'ear', 'face'] }, { question: 'ì–¼êµ´', answer: 'face', options: ['head', 'hair', 'eye', 'nose'] }, { question: 'ë†ì¥', answer: 'farm', options: ['field', 'garden', 'forest', 'house'] }, { question: 'ì•„ë¹ ', answer: 'father', options: ['mother', 'son', 'daughter', 'family'] }, { question: 'ë¬¼ê³ ê¸°', answer: 'fish', options: ['bird', 'dog', 'cat', 'frog'] }, { question: 'ê½ƒ', answer: 'flower', options: ['tree', 'leaf', 'grass', 'plant'] }, { question: 'ìŒì‹', answer: 'food', options: ['water', 'drink', 'snack', 'meal'] }, { question: 'ë°œ', answer: 'foot', options: ['hand', 'leg', 'arm', 'head'] }, { question: 'ì¹œêµ¬', answer: 'friend', options: ['family', 'teacher', 'student', 'neighbor'] }, { question: 'ê°œêµ¬ë¦¬', answer: 'frog', options: ['snake', 'lizard', 'turtle', 'fish'] }, { question: 'ê²Œì„', answer: 'game', options: ['sport', 'play', 'toy', 'hobby'] }, { question: 'ì •ì›', answer: 'garden', options: ['park', 'forest', 'field', 'yard'] }, { question: 'ì†Œë…€', answer: 'girl', options: ['boy', 'woman', 'man', 'baby'] }, { question: 'ìœ ë¦¬', answer: 'glass', options: ['cup', 'bottle', 'bowl', 'plate'] }, { question: 'ì†', answer: 'hand', options: ['foot', 'arm', 'leg', 'finger'] }, { question: 'ëª¨ì', answer: 'hat', options: ['cap', 'helmet', 'scarf', 'glove'] }, { question: 'ë¨¸ë¦¬', answer: 'head', options: ['face', 'hair', 'eye', 'ear'] }, { question: 'ì§‘', answer: 'house', options: ['home', 'school', 'store', 'office'] }, { question: 'ì–¼ìŒ', answer: 'ice', options: ['water', 'snow', 'fire', 'hot'] }, { question: 'ì„¬', answer: 'island', options: ['beach', 'sea', 'ocean', 'land'] }, { question: 'ì£¼ìŠ¤', answer: 'juice', options: ['water', 'milk', 'soda', 'tea'] }, { question: 'ì—´ì‡ ', answer: 'key', options: ['lock', 'door', 'box', 'safe'] }, { question: 'ì™•', answer: 'king', options: ['queen', 'prince', 'princess', 'castle'] }, { question: 'ë‹¤ë¦¬', answer: 'leg', options: ['arm', 'foot', 'hand', 'body'] }, { question: 'í¸ì§€', answer: 'letter', options: ['mail', 'card', 'email', 'word'] }, { question: 'ì‚¬ì', answer: 'lion', options: ['tiger', 'bear', 'wolf', 'fox'] }, { question: 'ë‚¨ì', answer: 'man', options: ['woman', 'boy', 'girl', 'person'] }, { question: 'ì§€ë„', answer: 'map', options: ['road', 'city', 'country', 'world'] }, { question: 'ê³ ê¸°', answer: 'meat', options: ['fish', 'chicken', 'pork', 'beef'] }, { question: 'ìš°ìœ ', answer: 'milk', options: ['water', 'juice', 'cheese', 'yogurt'] }, { question: 'ëˆ', answer: 'money', options: ['coin', 'bill', 'cash', 'price'] }, { question: 'ì›ìˆ­ì´', answer: 'monkey', options: ['gorilla', 'chimp', 'banana', 'jungle'] }, { question: 'ë‹¬', answer: 'moon', options: ['sun', 'star', 'sky', 'night'] }, { question: 'ì•„ì¹¨', answer: 'morning', options: ['evening', 'afternoon', 'night', 'day'] }, { question: 'ì—„ë§ˆ', answer: 'mother', options: ['father', 'son', 'daughter', 'parent'] }, { question: 'ì´ë¦„', answer: 'name', options: ['age', 'address', 'phone', 'word'] }, { question: 'ë°¤', answer: 'night', options: ['day', 'morning', 'evening', 'dark'] }, { question: 'ì½”', answer: 'nose', options: ['eye', 'mouth', 'ear', 'smell'] }, { question: 'ê³µì±…', answer: 'note', options: ['book', 'paper', 'pen', 'pencil'] }, { question: 'ì˜¤ë Œì§€', answer: 'orange', options: ['apple', 'banana', 'grape', 'lemon'] }, { question: 'ê³µì›', answer: 'park', options: ['garden', 'playground', 'field', 'forest'] }, { question: 'íœ', answer: 'pen', options: ['pencil', 'marker', 'crayon', 'write'] }, { question: 'ì—°í•„', answer: 'pencil', options: ['pen', 'eraser', 'ruler', 'draw'] }, { question: 'ë¼ì§€', answer: 'pig', options: ['cow', 'sheep', 'horse', 'farm'] }, { question: 'ë¹„í–‰ê¸°', answer: 'plane', options: ['car', 'bus', 'train', 'sky'] }, { question: 'ì‹ë¬¼', answer: 'plant', options: ['tree', 'flower', 'leaf', 'root'] }, { question: 'ì—¬ì™•', answer: 'queen', options: ['king', 'princess', 'prince', 'crown'] }, { question: 'í† ë¼', answer: 'rabbit', options: ['hare', 'carrot', 'jump', 'pet'] }, { question: 'ë¹„', answer: 'rain', options: ['snow', 'sun', 'cloud', 'weather'] }, { question: 'ì¥', answer: 'rat', options: ['mouse', 'cheese', 'hole', 'trap'] }, { question: 'ë°˜ì§€', answer: 'ring', options: ['necklace', 'bracelet', 'earring', 'gold'] }, { question: 'ê°•', answer: 'river', options: ['sea', 'lake', 'ocean', 'water'] }, { question: 'ê¸¸', answer: 'road', options: ['street', 'way', 'path', 'drive'] }, { question: 'ë¡œë´‡', answer: 'robot', options: ['machine', 'computer', 'toy', 'future'] }, { question: 'í•™êµ', answer: 'school', options: ['class', 'student', 'teacher', 'study'] }, { question: 'ë°”ë‹¤', answer: 'sea', options: ['ocean', 'river', 'lake', 'beach'] }, { question: 'ì–‘', answer: 'sheep', options: ['goat', 'cow', 'farm', 'wool'] }, { question: 'ë°°', answer: 'ship', options: ['boat', 'sea', 'port', 'sail'] }, { question: 'ì‹ ë°œ', answer: 'shoe', options: ['boot', 'sandal', 'sock', 'foot'] }, { question: 'í•˜ëŠ˜', answer: 'sky', options: ['sun', 'moon', 'cloud', 'blue'] }, { question: 'ëˆˆ', answer: 'snow', options: ['rain', 'ice', 'winter', 'white'] }, { question: 'ë…¸ë˜', answer: 'song', options: ['music', 'sing', 'dance', 'voice'] }, { question: 'ë³„', answer: 'star', options: ['sun', 'moon', 'sky', 'night'] }, { question: 'ëŒ', answer: 'stone', options: ['rock', 'sand', 'hard', 'build'] }, { question: 'ê°€ê²Œ', answer: 'store', options: ['shop', 'market', 'buy', 'sell'] }, { question: 'í•´', answer: 'sun', options: ['moon', 'star', 'sky', 'day'] }, { question: 'ì‹íƒ', answer: 'table', options: ['desk', 'chair', 'eat', 'food'] }, { question: 'í˜¸ë‘ì´', answer: 'tiger', options: ['lion', 'cat', 'zoo', 'stripe'] }, { question: 'ì¥ë‚œê°', answer: 'toy', options: ['doll', 'ball', 'game', 'play'] }, { question: 'ê¸°ì°¨', answer: 'train', options: ['bus', 'car', 'station', 'track'] }, { question: 'ë‚˜ë¬´', answer: 'tree', options: ['plant', 'flower', 'leaf', 'forest'] }, { question: 'ë¬¼', answer: 'water', options: ['drink', 'sea', 'river', 'rain'] }, { question: 'ì°½ë¬¸', answer: 'window', options: ['door', 'wall', 'glass', 'open'] }, { question: 'ì—¬ì', answer: 'woman', options: ['man', 'girl', 'boy', 'person'] }, { question: 'ì„¸ìƒ', answer: 'world', options: ['earth', 'country', 'people', 'map'] }, { question: 'ë™ë¬¼ì›', answer: 'zoo', options: ['animal', 'park', 'cage', 'lion'] },
            { question: 'ë¬»ë‹¤', answer: 'ask', options: ['answer', 'tell', 'say', 'speak'] }, { question: 'ì˜¤ë‹¤', answer: 'come', options: ['go', 'walk', 'run', 'arrive'] }, { question: 'ìë¥´ë‹¤', answer: 'cut', options: ['break', 'tear', 'slice', 'chop'] }, { question: 'ì¶¤ì¶”ë‹¤', answer: 'dance', options: ['sing', 'jump', 'move', 'music'] }, { question: 'í•˜ë‹¤', answer: 'do', options: ['make', 'work', 'play', 'act'] }, { question: 'ê·¸ë¦¬ë‹¤', answer: 'draw', options: ['paint', 'write', 'color', 'picture'] }, { question: 'ë§ˆì‹œë‹¤', answer: 'drink', options: ['eat', 'swallow', 'sip', 'water'] }, { question: 'ìš´ì „í•˜ë‹¤', answer: 'drive', options: ['ride', 'walk', 'fly', 'car'] }, { question: 'ë¨¹ë‹¤', answer: 'eat', options: ['drink', 'bite', 'chew', 'food'] }, { question: 'ì°¾ë‹¤', answer: 'find', options: ['lose', 'search', 'look', 'get'] }, { question: 'ë‚ ë‹¤', answer: 'fly', options: ['jump', 'run', 'swim', 'plane'] }, { question: 'ì–»ë‹¤', answer: 'get', options: ['give', 'take', 'receive', 'have'] }, { question: 'ì£¼ë‹¤', answer: 'give', options: ['get', 'take', 'send', 'offer'] }, { question: 'ê°€ë‹¤', answer: 'go', options: ['come', 'walk', 'run', 'leave'] }, { question: 'ê°€ì§€ë‹¤', answer: 'have', options: ['get', 'own', 'hold', 'possess'] }, { question: 'ë“£ë‹¤', answer: 'hear', options: ['listen', 'sound', 'voice', 'ear'] }, { question: 'ë•ë‹¤', answer: 'help', options: ['assist', 'support', 'work', 'aid'] }, { question: 'ì¹˜ë‹¤', answer: 'hit', options: ['strike', 'beat', 'punch', 'touch'] }, { question: 'ì í”„í•˜ë‹¤', answer: 'jump', options: ['hop', 'leap', 'fly', 'run'] }, { question: 'ì•Œë‹¤', answer: 'know', options: ['think', 'learn', 'see', 'understand'] }, { question: 'ë°°ìš°ë‹¤', answer: 'learn', options: ['study', 'teach', 'know', 'read'] }, { question: 'ì¢‹ì•„í•˜ë‹¤', answer: 'like', options: ['love', 'hate', 'enjoy', 'prefer'] }, { question: 'ë“£ë‹¤(ì£¼ì˜ê¹Šê²Œ)', answer: 'listen', options: ['hear', 'sound', 'music', 'ear'] }, { question: 'ì‚´ë‹¤', answer: 'live', options: ['stay', 'be', 'exist', 'house'] }, { question: 'ë³´ë‹¤', answer: 'look', options: ['see', 'watch', 'view', 'eye'] }, { question: 'ì‚¬ë‘í•˜ë‹¤', answer: 'love', options: ['like', 'hate', 'adore', 'care'] }, { question: 'ë§Œë“¤ë‹¤', answer: 'make', options: ['do', 'create', 'build', 'form'] }, { question: 'ë§Œë‚˜ë‹¤', answer: 'meet', options: ['see', 'greet', 'find', 'friend'] }, { question: 'ì—´ë‹¤', answer: 'open', options: ['close', 'shut', 'start', 'door'] }, { question: 'ë†€ë‹¤', answer: 'play', options: ['work', 'study', 'game', 'toy'] }, { question: 'ë†“ë‹¤', answer: 'put', options: ['place', 'set', 'move', 'lay'] }, { question: 'ì½ë‹¤', answer: 'read', options: ['write', 'study', 'book', 'letter'] }, { question: 'íƒ€ë‹¤', answer: 'ride', options: ['drive', 'walk', 'bike', 'horse'] }, { question: 'ë‹¬ë¦¬ë‹¤', answer: 'run', options: ['walk', 'jog', 'race', 'fast'] }, { question: 'ë§í•˜ë‹¤', answer: 'say', options: ['tell', 'speak', 'talk', 'ask'] }, { question: 'ë³´ë‹¤', answer: 'see', options: ['look', 'watch', 'view', 'eye'] }, { question: 'ë…¸ë˜í•˜ë‹¤', answer: 'sing', options: ['dance', 'shout', 'music', 'song'] }, { question: 'ì•‰ë‹¤', answer: 'sit', options: ['stand', 'lie', 'chair', 'down'] }, { question: 'ìë‹¤', answer: 'sleep', options: ['wake', 'rest', 'dream', 'bed'] }, { question: 'ë§í•˜ë‹¤', answer: 'speak', options: ['talk', 'say', 'tell', 'language'] }, { question: 'ì„œë‹¤', answer: 'stand', options: ['sit', 'lie', 'up', 'walk'] }, { question: 'ë©ˆì¶”ë‹¤', answer: 'stop', options: ['start', 'go', 'finish', 'end'] }, { question: 'ê³µë¶€í•˜ë‹¤', answer: 'study', options: ['learn', 'read', 'write', 'school'] }, { question: 'ìˆ˜ì˜í•˜ë‹¤', answer: 'swim', options: ['dive', 'float', 'water', 'pool'] }, { question: 'ê°€ì ¸ê°€ë‹¤', answer: 'take', options: ['get', 'give', 'bring', 'hold'] }, { question: 'ë§í•˜ë‹¤', answer: 'talk', options: ['speak', 'say', 'chat', 'discuss'] }, { question: 'ìƒê°í•˜ë‹¤', answer: 'think', options: ['know', 'believe', 'guess', 'idea'] }, { question: 'ê±·ë‹¤', answer: 'walk', options: ['run', 'go', 'step', 'foot'] }, { question: 'ì›í•˜ë‹¤', answer: 'want', options: ['need', 'wish', 'like', 'desire'] }, { question: 'ì“°ë‹¤', answer: 'write', options: ['read', 'draw', 'pen', 'letter'] },
            { question: 'í™”ë‚œ', answer: 'angry', options: ['happy', 'sad', 'mad', 'upset'] }, { question: 'ë‚˜ìœ', answer: 'bad', options: ['good', 'wrong', 'evil', 'poor'] }, { question: 'í°', answer: 'big', options: ['small', 'large', 'huge', 'great'] }, { question: 'ê²€ì€ìƒ‰', answer: 'black', options: ['white', 'red', 'blue', 'dark'] }, { question: 'íŒŒë€ìƒ‰', answer: 'blue', options: ['red', 'yellow', 'green', 'sky'] }, { question: 'ê°ˆìƒ‰', answer: 'brown', options: ['black', 'white', 'tan', 'wood'] }, { question: 'ê¹¨ë—í•œ', answer: 'clean', options: ['dirty', 'wash', 'clear', 'neat'] }, { question: 'ì¶”ìš´', answer: 'cold', options: ['hot', 'cool', 'warm', 'ice'] }, { question: 'ì–´ë‘ìš´', answer: 'dark', options: ['light', 'bright', 'black', 'night'] }, { question: 'ë”ëŸ¬ìš´', answer: 'dirty', options: ['clean', 'messy', 'mud', 'dust'] }, { question: 'ë§ˆë¥¸', answer: 'dry', options: ['wet', 'water', 'towel', 'sand'] }, { question: 'ì‰¬ìš´', answer: 'easy', options: ['hard', 'simple', 'difficult', 'soft'] }, { question: 'ë¹ ë¥¸', answer: 'fast', options: ['slow', 'quick', 'run', 'speed'] }, { question: 'ëš±ëš±í•œ', answer: 'fat', options: ['thin', 'big', 'heavy', 'plump'] }, { question: 'ì¢‹ì€', answer: 'good', options: ['bad', 'great', 'nice', 'fine'] }, { question: 'ì´ˆë¡ìƒ‰', answer: 'green', options: ['red', 'blue', 'yellow', 'grass'] }, { question: 'í–‰ë³µí•œ', answer: 'happy', options: ['sad', 'glad', 'joy', 'smile'] }, { question: 'ì–´ë ¤ìš´', answer: 'hard', options: ['easy', 'soft', 'difficult', 'tough'] }, { question: 'ë¬´ê±°ìš´', answer: 'heavy', options: ['light', 'big', 'stone', 'lift'] }, { question: 'ëœ¨ê±°ìš´', answer: 'hot', options: ['cold', 'warm', 'fire', 'sun'] }, { question: 'í°', answer: 'large', options: ['small', 'big', 'huge', 'wide'] }, { question: 'ê°€ë²¼ìš´', answer: 'light', options: ['heavy', 'dark', 'bright', 'easy'] }, { question: 'ê¸´', answer: 'long', options: ['short', 'tall', 'big', 'line'] }, { question: 'ìƒˆë¡œìš´', answer: 'new', options: ['old', 'young', 'fresh', 'modern'] }, { question: 'ì˜¤ë˜ëœ', answer: 'old', options: ['new', 'young', 'ancient', 'age'] }, { question: 'í•˜ë‚˜', answer: 'one', options: ['two', 'three', 'four', 'first'] }, { question: 'ì£¼í™©ìƒ‰', answer: 'orange', options: ['yellow', 'red', 'fruit', 'color'] }, { question: 'ê°€ë‚œí•œ', answer: 'poor', options: ['rich', 'needy', 'money', 'bad'] }, { question: 'ì˜ˆìœ', answer: 'pretty', options: ['beautiful', 'cute', 'ugly', 'nice'] }, { question: 'ìì£¼ìƒ‰', answer: 'purple', options: ['violet', 'grape', 'flower', 'color'] }, { question: 'ë¹ ë¥¸', answer: 'quick', options: ['fast', 'slow', 'rapid', 'swift'] }, { question: 'ì¡°ìš©í•œ', answer: 'quiet', options: ['loud', 'silent', 'calm', 'soft'] }, { question: 'ë¹¨ê°„ìƒ‰', answer: 'red', options: ['blue', 'yellow', 'green', 'apple'] }, { question: 'ë¶€ìœ í•œ', answer: 'rich', options: ['poor', 'wealthy', 'money', 'gold'] }, { question: 'ìŠ¬í”ˆ', answer: 'sad', options: ['happy', 'unhappy', 'cry', 'tear'] }, { question: 'ì§§ì€', answer: 'short', options: ['long', 'tall', 'small', 'brief'] }, { question: 'ì•„í”ˆ', answer: 'sick', options: ['ill', 'well', 'healthy', 'pain'] }, { question: 'ëŠë¦°', answer: 'slow', options: ['fast', 'quick', 'late', 'walk'] }, { question: 'ì‘ì€', answer: 'small', options: ['big', 'little', 'tiny', 'short'] }, { question: 'ë¶€ë“œëŸ¬ìš´', answer: 'soft', options: ['hard', 'gentle', 'smooth', 'fluffy'] }, { question: 'ê°•í•œ', answer: 'strong', options: ['weak', 'powerful', 'tough', 'hard'] }, { question: 'í‚¤ê°€ í°', answer: 'tall', options: ['short', 'long', 'high', 'big'] }, { question: 'ë§ˆë¥¸', answer: 'thin', options: ['fat', 'slim', 'narrow', 'light'] }, { question: 'ëª»ìƒê¸´', answer: 'ugly', options: ['pretty', 'beautiful', 'bad', 'horrible'] }, { question: 'ë”°ëœ»í•œ', answer: 'warm', options: ['hot', 'cold', 'cool', 'sun'] }, { question: 'ì•½í•œ', answer: 'weak', options: ['strong', 'feeble', 'frail', 'sick'] }, { question: 'ì –ì€', answer: 'wet', options: ['dry', 'damp', 'water', 'rain'] }, { question: 'í°ìƒ‰', answer: 'white', options: ['black', 'red', 'snow', 'light'] }, { question: 'ì–´ë¦°', answer: 'young', options: ['old', 'new', 'child', 'baby'] }, { question: 'ë…¸ë€ìƒ‰', answer: 'yellow', options: ['red', 'blue', 'sun', 'lemon'] }
        ];

        const shopItems = [
            { name: 'ë‚˜ë¬´', emoji: 'ğŸŒ³', price: 100 },
            { name: 'ê½ƒ', emoji: 'ğŸŒ¸', price: 50 },
            { name: 'ë°”ìœ„', emoji: 'ğŸª¨', price: 70 },
            { name: 'ìš¸íƒ€ë¦¬', emoji: 'ğŸš§', price: 150 },
            { name: 'ì§‘', emoji: 'ğŸ ', price: 500 },
            { name: 'ì—°ëª»', emoji: 'ğŸ’§', price: 300 }
        ];

        // ==================== í•µì‹¬ ê²Œì„ í•¨ìˆ˜ ====================
        
        function generateQuestion() {
            const difficulty = Math.min(Math.floor(gameState.level / 3) + 1, 4);
            let question = {};
            
            switch(difficulty) {
                case 1:
                    const a1 = Math.floor(Math.random() * 10) + 1;
                    const b1 = Math.floor(Math.random() * 10) + 1;
                    if (Math.random() > 0.5) {
                        question = {text: `${a1} + ${b1}`, answer: a1 + b1};
                    } else {
                        const larger = Math.max(a1, b1);
                        const smaller = Math.min(a1, b1);
                        question = {text: `${larger} - ${smaller}`, answer: larger - smaller};
                    }
                    break;
                case 2:
                    const a2 = Math.floor(Math.random() * 90) + 10;
                    const b2 = Math.floor(Math.random() * 90) + 10;
                    if (Math.random() > 0.5) {
                        question = {text: `${a2} + ${b2}`, answer: a2 + b2};
                    } else {
                        const larger = Math.max(a2, b2);
                        const smaller = Math.min(a2, b2);
                        question = {text: `${larger} - ${smaller}`, answer: larger - smaller};
                    }
                    break;
                case 3:
                    const a3 = Math.floor(Math.random() * 8) + 2;
                    const b3 = Math.floor(Math.random() * 8) + 2;
                    question = {text: `${a3} Ã— ${b3}`, answer: a3 * b3};
                    break;
                case 4:
                    const a4 = Math.floor(Math.random() * 900) + 100;
                    const b4 = Math.floor(Math.random() * 900) + 100;
                    if (Math.random() > 0.5) {
                        question = {text: `${a4} + ${b4}`, answer: a4 + b4};
                    } else {
                        const larger = Math.max(a4, b4);
                        const smaller = Math.min(a4, b4);
                        question = {text: `${larger} - ${smaller}`, answer: larger - smaller};
                    }
                    break;
            }
            
            gameState.currentQuestion = question;
            document.getElementById('question').textContent = `${question.text} = ?`;
            document.getElementById('answer').value = '';
            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = 'feedback';
            
            const difficultyNames = ['ì‰¬ì›€', 'ë³´í†µ', 'ì–´ë ¤ì›€', 'ë§¤ìš° ì–´ë ¤ì›€'];
            document.getElementById('difficulty').textContent = difficultyNames[difficulty - 1];
        }

        function checkAnswer() {
            const userAnswer = parseInt(document.getElementById('answer').value);
            const feedback = document.getElementById('feedback');
            
            if (isNaN(userAnswer)) {
                feedback.textContent = 'ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”! ğŸ”¢';
                feedback.className = 'feedback incorrect';
                return;
            }
            
            if (userAnswer === gameState.currentQuestion.answer) {
                gameState.score += 10 * gameState.level;
                feedback.textContent = 'ì •ë‹µì…ë‹ˆë‹¤! í›Œë¥­í•´ìš”! ğŸ‰';
                feedback.className = 'feedback correct';
                
                const newAnimal = getRandomAnimal();
                addAnimal(newAnimal);
                
                if (gameState.score >= gameState.level * 50) {
                    gameState.level++;
                    showLevelUp();
                }
                
                saveCurrentUserData();
                
                setTimeout(() => {
                    generateQuestion();
                }, 1500);
                
            } else {
                feedback.textContent = `í‹€ë ¸ì–´ìš”! ì •ë‹µì€ ${gameState.currentQuestion.answer}ì…ë‹ˆë‹¤. ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”! ğŸ’ª`;
                feedback.className = 'feedback incorrect';
                
                setTimeout(() => {
                    generateQuestion();
                }, 2500);
            }
            
            updateUI();
        }

        function getRandomAnimal() {
            const maxRarity = Math.min(Math.floor(gameState.level / 2) + 1, 6);
            const availableAnimals = animalTypes.filter(animal => animal.rarity <= maxRarity);
            const weights = availableAnimals.map(animal => Math.pow(0.7, animal.rarity - 1));
            const totalWeight = weights.reduce((sum, weight) => sum + weight, 0);
            let random = Math.random() * totalWeight;
            for (let i = 0; i < availableAnimals.length; i++) {
                random -= weights[i];
                if (random <= 0) {
                    return availableAnimals[i];
                }
            }
            return availableAnimals[0];
        }

        function addAnimal(animal) {
            const key = animal.name;
            if (!gameState.animals[key]) {
                gameState.animals[key] = {
                    ...animal,
                    count: 0,
                    animalLevel: 1 
                };
                gameState.speciesCount++;
                showNewAnimalAlert(animal);
            }
            
            gameState.animals[key].count++;
            gameState.totalAnimals++;
            
            updateAnimalCollection();
        }
        
        function startFeedingQuiz(animalName) {
            const animal = gameState.animals[animalName];
            const quizData = { ...quizWords[Math.floor(Math.random() * quizWords.length)] };
            
            document.getElementById('quiz-question').innerText = `'${animal.name}'ì—ê²Œ ë¨¹ì´ë¡œ ì¤„ '${quizData.question}'ì˜ ì˜ì–´ ë‹¨ì–´ëŠ”?`;
            
            const wrongOptions = quizData.options.filter(opt => opt !== quizData.answer).sort(() => 0.5 - Math.random()).slice(0, 3);
            const finalOptions = [quizData.answer, ...wrongOptions].sort(() => Math.random() - 0.5);
            
            const optionsContainer = document.getElementById('quiz-options');
            optionsContainer.innerHTML = '';
            finalOptions.forEach(option => {
                const button = document.createElement('button');
                button.className = 'quiz-option-btn';
                button.innerText = option;
                button.onclick = () => checkQuizAnswer(option, quizData.answer, animalName);
                optionsContainer.appendChild(button);
            });

            document.getElementById('quiz-modal').style.display = 'flex';
        }

        function checkQuizAnswer(selectedOption, correctAnswer, animalName) {
            if (selectedOption === correctAnswer) {
                gameState.animals[animalName].animalLevel++;
                alert('ì •ë‹µ! ë™ë¬¼ì˜ ë ˆë²¨ì´ ì˜¬ëì–´ìš”! ì‘¥ì‘¥! ğŸŒŸ');
                closeQuizModal();
                updateAnimalCollection();
                saveCurrentUserData();
            } else {
                alert('ì´ëŸ°, ë‹¤ë¥¸ ë¨¹ì´ì¸ê°€ ë´ìš”. ë‹¤ì‹œ ì‹œë„í•´ ë³´ì„¸ìš”! ğŸ¤”');
                closeQuizModal();
            }
        }

        function closeQuizModal() {
            document.getElementById('quiz-modal').style.display = 'none';
        }


        // ==================== UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ====================

        function updateUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('species-count').textContent = gameState.speciesCount;
            document.getElementById('total-animals').textContent = gameState.totalAnimals;
        }

        function updateAnimalCollection() {
            const collection = document.getElementById('animal-collection');
            collection.innerHTML = '';
            
            const sortedAnimals = Object.values(gameState.animals).sort((a, b) => b.rarity - a.rarity);
            
            sortedAnimals.forEach(animal => {
                if (animal.count === 0) return;

                const card = document.createElement('div');
                card.className = 'animal-card';
                
                let borderColor = '#87CEEB';
                if (animal.rarity >= 5) borderColor = '#FFD700';
                else if (animal.rarity >= 4) borderColor = '#9370DB';
                else if (animal.rarity >= 3) borderColor = '#32CD32';
                
                card.style.borderColor = borderColor;
                card.style.boxShadow = `0 6px 20px ${borderColor}40`;
                
                card.innerHTML = `
                    <span class="animal-emoji">${animal.emoji}</span>
                    <div class="animal-name">${animal.name} (${animal.count}ë§ˆë¦¬)</div>
                    <div class="animal-level">Lv. ${animal.animalLevel || 1}</div>
                    <div class="special-name">"${animal.specialName}"</div>
                    <div class="rarity-badge">â˜…${animal.rarity}</div>
                `;
                
                card.onclick = () => startFeedingQuiz(animal.name);
                collection.appendChild(card);
            });
        }
        
        function updateEncyclopedia() {
            const grid = document.getElementById('encyclopedia-grid');
            grid.innerHTML = '';

            const collectedCount = gameState.speciesCount;
            const totalCount = animalTypes.length;
            document.getElementById('collection-progress').textContent = `${collectedCount} / ${totalCount}`;
            
            const progressPercent = totalCount > 0 ? (collectedCount / totalCount) * 100 : 0;
            document.getElementById('progress-bar').style.width = `${progressPercent}%`;

            animalTypes.forEach(animal => {
                const collectedAnimal = gameState.animals[animal.name];
                const card = document.createElement('div');
                card.className = 'encyclopedia-card';
                
                if (collectedAnimal) {
                    card.innerHTML = `
                        <span class="animal-emoji">${animal.emoji}</span>
                        <div class="animal-name">${animal.name}</div>
                        <div class="animal-count">${collectedAnimal.count}ë§ˆë¦¬ ë³´ìœ </div>
                        <div class="rarity-badge">â˜…${animal.rarity}</div>
                    `;
                } else {
                    card.classList.add('uncollected');
                    card.innerHTML = `
                        <span class="animal-emoji">â“</span>
                        <div class="animal-name">???</div>
                        <div class="animal-count">ë¯¸ë°œê²¬</div>
                        <div class="rarity-badge">â˜…${animal.rarity}</div>
                    `;
                }
                grid.appendChild(card);
            });
        }

        // ==================== ë†ì¥ ê´€ë ¨ í•¨ìˆ˜ ====================
        
        function initializeFarm() {
            const farmGrid = document.getElementById('farm-grid');
            farmGrid.innerHTML = '';
            for (let i = 0; i < 48; i++) {
                const cell = document.createElement('div');
                cell.className = 'farm-cell';
                cell.dataset.index = i;
                cell.onclick = () => placeItemOnFarm(i);
                farmGrid.appendChild(cell);
            }
            updateShop();
            updateInventory();
            renderFarm();
        }

        function updateShop() {
            const shopGrid = document.getElementById('shop-grid');
            shopGrid.innerHTML = '';
            shopItems.forEach(item => {
                const shopItemDiv = document.createElement('div');
                shopItemDiv.className = 'shop-item';
                shopItemDiv.innerHTML = `
                    <div class="item-emoji">${item.emoji}</div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-price">ğŸ’° ${item.price}</div>
                `;
                shopItemDiv.onclick = () => buyItem(item.name);
                shopGrid.appendChild(shopItemDiv);
            });
        }

        function buyItem(itemName) {
            const item = shopItems.find(i => i.name === itemName);
            if (gameState.score >= item.price) {
                gameState.score -= item.price;
                if (!gameState.farm.items[itemName]) {
                    gameState.farm.items[itemName] = { ...item, count: 0 };
                }
                gameState.farm.items[itemName].count++;
                alert(`${itemName}ì„(ë¥¼) êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!`);
                updateUI();
                updateInventory();
                saveCurrentUserData();
            } else {
                alert('ì ìˆ˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!');
            }
        }

        function updateInventory() {
            const inventoryGrid = document.getElementById('inventory-grid');
            inventoryGrid.innerHTML = '';
            Object.values(gameState.farm.items).forEach(item => {
                if (item.count > 0) {
                    const invItemDiv = document.createElement('div');
                    invItemDiv.className = 'inventory-item';
                    invItemDiv.dataset.itemName = item.name;
                    invItemDiv.innerHTML = `
                        <div class="item-emoji">${item.emoji}</div>
                        <div class="item-name">${item.name}</div>
                        <div class="item-count">x ${item.count}</div>
                    `;
                    invItemDiv.onclick = () => selectItemToPlace(item.name);
                    inventoryGrid.appendChild(invItemDiv);
                }
            });
            // ë™ë¬¼ë„ ì¸ë²¤í† ë¦¬ì— ì¶”ê°€
            Object.values(gameState.animals).forEach(animal => {
                 if (animal.count > 0) {
                    const invItemDiv = document.createElement('div');
                    invItemDiv.className = 'inventory-item';
                    invItemDiv.dataset.itemName = animal.name;
                    invItemDiv.innerHTML = `
                        <div class="item-emoji">${animal.emoji}</div>
                        <div class="item-name">${animal.name}</div>
                        <div class="item-count">x ${animal.count}</div>
                    `;
                    invItemDiv.onclick = () => selectItemToPlace(animal.name, true);
                    inventoryGrid.appendChild(invItemDiv);
                }
            });
        }

        function selectItemToPlace(itemName, isAnimal = false) {
            selectedItemToPlace = { name: itemName, isAnimal };
            document.querySelectorAll('.inventory-item').forEach(el => el.classList.remove('selected'));
            document.querySelector(`.inventory-item[data-item-name="${itemName}"]`).classList.add('selected');
        }

        function placeItemOnFarm(index) {
            if (!selectedItemToPlace) return;

            const { name, isAnimal } = selectedItemToPlace;
            const currentCellContent = gameState.farm.layout[index];

            // ì…€ ë¹„ìš°ê¸° (ì˜¤ë¥¸ìª½ í´ë¦­)
            if (event.button === 2 || event.ctrlKey) { // Ctrl+Click for context menu prevention
                event.preventDefault();
                if (currentCellContent) {
                    if (currentCellContent.isAnimal) {
                        gameState.animals[currentCellContent.name].count++;
                    } else {
                        gameState.farm.items[currentCellContent.name].count++;
                    }
                    gameState.farm.layout[index] = null;
                    renderFarm();
                    updateInventory();
                    saveCurrentUserData();
                }
                return;
            }

            // ì•„ì´í…œ ë°°ì¹˜
            if (isAnimal) {
                if (gameState.animals[name].count > 0) {
                    if (currentCellContent) { // ì´ë¯¸ ì•„ì´í…œì´ ìˆë‹¤ë©´ ë˜ëŒë¦¬ê¸°
                         if (currentCellContent.isAnimal) gameState.animals[currentCellContent.name].count++;
                         else gameState.farm.items[currentCellContent.name].count++;
                    }
                    gameState.farm.layout[index] = { name, isAnimal: true, emoji: gameState.animals[name].emoji };
                    gameState.animals[name].count--;
                }
            } else {
                if (gameState.farm.items[name].count > 0) {
                    if (currentCellContent) {
                         if (currentCellContent.isAnimal) gameState.animals[currentCellContent.name].count++;
                         else gameState.farm.items[currentCellContent.name].count++;
                    }
                    gameState.farm.layout[index] = { name, isAnimal: false, emoji: gameState.farm.items[name].emoji };
                    gameState.farm.items[name].count--;
                }
            }
            
            selectedItemToPlace = null;
            renderFarm();
            updateInventory();
            saveCurrentUserData();
        }

        function renderFarm() {
            const farmGrid = document.getElementById('farm-grid');
            gameState.farm.layout.forEach((item, index) => {
                const cell = farmGrid.children[index];
                if (item) {
                    cell.innerHTML = `<span class="${item.isAnimal ? 'placed-animal' : ''}">${item.emoji}</span>`;
                } else {
                    cell.innerHTML = '';
                }
            });
        }


        // ==================== íŠ¹ìˆ˜ íš¨ê³¼ í•¨ìˆ˜ ====================
        function showNewAnimalAlert(animal) {
            const alert = document.createElement('div');
            alert.className = 'new-animal-alert';
            alert.innerHTML = `
                <span class="new-animal-emoji">${animal.emoji}</span>
                <h3>ìƒˆë¡œìš´ ë™ë¬¼ ë°œê²¬! ğŸ‰</h3>
                <p><strong>${animal.specialName}</strong> (${animal.name})ì„(ë¥¼) íšë“í–ˆìŠµë‹ˆë‹¤!</p>
            `;
            document.body.appendChild(alert);
            setTimeout(() => { alert.remove(); }, 3000);
        }

        function showLevelUp() {
            const alert = document.createElement('div');
            alert.className = 'new-animal-alert';
            alert.innerHTML = `
                <span class="new-animal-emoji">â­</span>
                <h3>ë ˆë²¨ ì—…! ğŸ‰</h3>
                <p>ë ˆë²¨ ${gameState.level}ì´ ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
                <p>ë” ì–´ë ¤ìš´ ë¬¸ì œì— ë„ì „í•  ìˆ˜ ìˆì–´ìš”!</p>
            `;
            document.body.appendChild(alert);
            setTimeout(() => { alert.remove(); }, 3000);
        }


        // ==================== ì‚¬ìš©ì ê´€ë¦¬ ë° ë°ì´í„° í•¨ìˆ˜ ====================

        function createUser() {
            const userName = document.getElementById('new-user-name').value.trim();
            if (!userName) return alert('ì‚¬ìš©ì ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            if (allUsers[userName]) return alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìì…ë‹ˆë‹¤!');
            
            allUsers[userName] = {
                name: userName, score: 0, level: 1, animals: {},
                totalAnimals: 0, speciesCount: 0,
                farm: { layout: Array(48).fill(null), items: {} },
                createdAt: new Date().toISOString(), lastPlayed: new Date().toISOString()
            };
            document.getElementById('new-user-name').value = '';
            alert(`ğŸ‰ ${userName} ì‚¬ìš©ìê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            updateUserList();
            saveAllUsersToStorage();
        }

        function switchUser(userName) {
            if (!allUsers[userName]) {
                console.error("Switching to a non-existent user:", userName);
                return;
            }
            
            saveCurrentUserData();
            
            currentUser = userName;
            const userData = allUsers[userName];
            
            gameState = {
                score: userData.score || 0,
                level: userData.level || 1,
                animals: userData.animals || {},
                totalAnimals: userData.totalAnimals || 0,
                speciesCount: userData.speciesCount || 0,
                farm: userData.farm || { layout: Array(48).fill(null), items: {} },
                currentQuestion: {}
            };
            
            allUsers[userName].lastPlayed = new Date().toISOString();
            
            document.getElementById('current-user-name').textContent = userName;
            updateUI();
            updateAnimalCollection();
            updateUserList();
            generateQuestion();
            initializeFarm();
        }

        function saveCurrentUserData() {
            if (!currentUser || !allUsers[currentUser]) return;
            
            allUsers[currentUser] = {
                ...allUsers[currentUser],
                score: gameState.score,
                level: gameState.level,
                animals: gameState.animals,
                totalAnimals: gameState.totalAnimals,
                speciesCount: gameState.speciesCount,
                farm: gameState.farm,
                lastPlayed: new Date().toISOString()
            };
            saveAllUsersToStorage();
        }
        
        function updateUserList() {
            const userList = document.getElementById('user-list');
            userList.innerHTML = '';
            const sortedUsers = Object.values(allUsers).sort((a, b) => (b.score || 0) - (a.score || 0));
            
            sortedUsers.forEach((user, index) => {
                const userCard = document.createElement('div');
                userCard.className = 'user-card';
                if (user.name === currentUser) {
                    userCard.classList.add('active');
                }
                const rankIcon = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index + 1}ìœ„`;
                userCard.innerHTML = `
                    <h4>${rankIcon} ${user.name}</h4>
                    <div class="user-stats">
                        ë ˆë²¨: ${user.level || 1} | ì ìˆ˜: ${user.score || 0}ì <br>
                        ë™ë¬¼: ${user.totalAnimals || 0}ë§ˆë¦¬ (${user.speciesCount || 0}ì¢…)<br>
                        ë§ˆì§€ë§‰ í”Œë ˆì´: ${formatDate(user.lastPlayed)}
                    </div>
                `;
                userCard.onclick = () => switchUser(user.name);
                userList.appendChild(userCard);
            });
        }

        function formatDate(dateString) {
            if (!dateString) return 'ê¸°ë¡ ì—†ìŒ';
            const date = new Date(dateString);
            return date.toLocaleString('ko-KR', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        }

        function exportGameData() {
            saveCurrentUserData();
            const gameData = {
                users: allUsers,
                currentUser: currentUser,
                version: '2.3'
            };
            const dataStr = JSON.stringify(gameData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `ë™ë¬¼ìˆ˜ì§‘ê²Œì„-ë°±ì—…-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            alert('ğŸ“ ê²Œì„ ë°ì´í„°ê°€ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function importGameData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.users && typeof data.users === 'object') {
                        if (!confirm('âš ï¸ ê¸°ì¡´ ë°ì´í„°ë¥¼ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?\ní˜„ì¬ ë°ì´í„°ëŠ” ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤!')) {
                            return;
                        }
                        
                        allUsers = data.users;
                        currentUser = data.currentUser || Object.keys(allUsers)[0] || 'ê²ŒìŠ¤íŠ¸';
                        
                        saveAllUsersToStorage();
                        localStorage.setItem('mathGameCurrentUser', currentUser);
                        initializeGame();
                        
                        alert('âœ… ê²Œì„ ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
                    } else {
                        throw new Error('ì˜¬ë°”ë¥¸ ê²Œì„ ë°ì´í„° íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                    alert(`âŒ íŒŒì¼ì„ ì½ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì˜¤ë¥˜: ${error.message}`);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function resetAllData() {
            if (!confirm('âš ï¸ ì •ë§ë¡œ ëª¨ë“  ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
                return;
            }
            localStorage.removeItem('mathGameAllUsers');
            localStorage.removeItem('mathGameCurrentUser');
            
            allUsers = {};
            currentUser = 'ê²ŒìŠ¤íŠ¸';

            initializeGame();
            alert('ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }


        // ==================== í˜ì´ì§€ ê´€ë¦¬ ë° ì´ˆê¸°í™” ====================

        function showPage(pageName, element) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(pageName + '-page').classList.add('active');
            if (element) {
                element.classList.add('active');
            }
            
            const gameStats = document.getElementById('game-stats');
            const userInfo = document.getElementById('user-info');
            
            if (pageName === 'game') {
                gameStats.style.display = 'flex';
                userInfo.style.display = 'block';
            } else if (pageName === 'users') {
                gameStats.style.display = 'none';
                userInfo.style.display = 'block';
                updateUserList();
            } else if (pageName === 'encyclopedia') {
                gameStats.style.display = 'none';
                userInfo.style.display = 'block';
                updateEncyclopedia();
            } else if (pageName === 'farm') {
                gameStats.style.display = 'flex'; // ë†ì¥ì—ì„œë„ ì ìˆ˜ í™•ì¸
                userInfo.style.display = 'block';
                initializeFarm();
            } else {
                gameStats.style.display = 'none';
                userInfo.style.display = 'none';
            }
        }
        
        function saveAllUsersToStorage() {
            try {
                localStorage.setItem('mathGameAllUsers', JSON.stringify(allUsers));
            } catch (e) {
                console.error("Error saving to localStorage", e);
            }
        }

        function loadUsersFromStorage() {
            const storedData = localStorage.getItem('mathGameAllUsers');
            if (storedData) {
                try {
                    allUsers = JSON.parse(storedData);
                    currentUser = localStorage.getItem('mathGameCurrentUser') || Object.keys(allUsers)[0] || 'ê²ŒìŠ¤íŠ¸';
                } catch (e) {
                    console.error("Error parsing data from localStorage", e);
                    allUsers = {};
                    currentUser = 'ê²ŒìŠ¤íŠ¸';
                }
            }
        }

        function initializeGame() {
            loadUsersFromStorage();

            if (Object.keys(allUsers).length === 0 || !allUsers[currentUser]) {
                allUsers = {
                    'ê²ŒìŠ¤íŠ¸': { name: 'ê²ŒìŠ¤íŠ¸', score: 0, level: 1, animals: {}, totalAnimals: 0, speciesCount: 0, farm: { layout: Array(48).fill(null), items: {} }, createdAt: new Date().toISOString(), lastPlayed: new Date().toISOString() }
                };
                currentUser = 'ê²ŒìŠ¤íŠ¸';
                saveAllUsersToStorage();
                localStorage.setItem('mathGameCurrentUser', currentUser);
            }
            
            switchUser(currentUser);
            showPage('game', document.querySelector('.nav-btn'));
        }

        // ==================== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ====================

        window.addEventListener('load', initializeGame);
        
        document.getElementById('answer').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') checkAnswer();
        });
        document.getElementById('new-user-name').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') createUser();
        });

        window.addEventListener('beforeunload', function() {
            saveCurrentUserData();
            localStorage.setItem('mathGameCurrentUser', currentUser);
        });
        
        // ë†ì¥ ì…€ ì˜¤ë¥¸ìª½ í´ë¦­ ì´ë²¤íŠ¸ (ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ë°©ì§€)
        document.getElementById('farm-grid').addEventListener('contextmenu', e => e.preventDefault());

        console.log('ğŸ¾ ë™ë¬¼ ìˆ˜ì§‘ ìˆ˜í•™ ê²Œì„ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤! (v2.3)');
    </script>
</body>
</html>
